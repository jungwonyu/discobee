(function(){"use strict";class W extends Phaser.Scene{constructor(){super("Boot")}preload(){this.load.spritesheet("loading","assets/img/start/ice_spritesheet.png",{frameWidth:105,frameHeight:128}),this.load.image("logo","assets/img/start/icecandy_logo.png")}create(){const{width:e,height:t}=this.scale,s=this.add.rectangle(0,0,e,t,13234170).setOrigin(0,0),i=this.add.image(e/2,t/2,"logo").setAlpha(0).setScale(.7);i.setY(i.y+100),this.tweens.add({targets:i,alpha:1,y:"-=120",duration:150,ease:"ease-in-out",repeat:0,onComplete:()=>{this.tweens.add({targets:i,alpha:1,y:"+=20",duration:100,ease:"ease-in-out",repeat:0})}}),this.time.delayedCall(1200,()=>{this.tweens.add({targets:[i,s],alpha:0,duration:200,ease:"ease-in-out",repeat:0})}),this.time.delayedCall(1500,()=>this.scene.start("Preloader"))}}class G{constructor(){this.bgm=null,this.isOn=!0}init(e,t,s){this.bgm||(this.bgm=e.sound.add(t,{...s}))}play(){this.bgm.isPlaying||this.bgm.play()}toggle(){this.bgm&&(this.isOn?(this.bgm.pause(),this.isOn=!1):(this.bgm.isPaused?this.bgm.resume():this.bgm.play(),this.isOn=!0))}pause(){this.bgm?.isPlaying&&this.bgm.pause()}stop(){this.bgm.stop()}resume(){this.bgm&&!this.bgm.isPlaying&&this.bgm.resume()}}const P=new G;class F extends Phaser.Scene{constructor(){super("Preloader")}init(){this.cameras.main.setBackgroundColor(13234170);const e=9751772,t={width:500,height:30},s={x:this.scale.width/2-t.width/2,y:this.scale.height/2-t.height/2},i=t.height/2,a=8,n={width:t.width+a,height:t.height+a},o=i+a,r={x:s.x-a/2,y:s.y-a/2},h=this.add.graphics({fillStyle:{color:16777215},lineStyle:{width:3,color:e}});h.fillRoundedRect(r.x,r.y,n.width,n.height,o),h.strokeRoundedRect(r.x,r.y,n.width,n.height,o);const l=this.add.graphics({fillStyle:{color:e}});l.fillRoundedRect(s.x,s.y,t.height,t.height,i),this.anims.create({key:"loading",frames:this.anims.generateFrameNumbers("loading",{start:1,end:4}),frameRate:12,repeat:-1});const c=this.add.sprite(0,0,"loading").play("loading");c.setScale(.5),c.y=s.y+t.height/2-c.height/2+14,this.load.on("progress",m=>{const p=Math.max(t.height,t.width*m);l.clear(),l.fillRoundedRect(s.x,s.y,p,t.height,i),c.x=s.x+p-t.height/2})}preload(){this.load.font("Cafe24Surround","assets/font/Cafe24Ssurround-v2.0.ttf"),this.load.font("TMoneyDungunbaram","assets/font/TMONEYROUNDWINDEXTRABOLD.TTF"),this.load.font("Eommakkaturi","assets/font/Katuri.woff"),this.load.font("MaplestoryBold","assets/font/MaplestoryBold.ttf"),this.load.audio("bgm_audio","./assets/mp3/bgm.mp3"),this.load.audio("lose","./assets/mp3/lose.mp3"),this.load.audio("click","./assets/mp3/click.mp3"),this.load.audio("correct","assets/mp3/correct.mp3"),this.load.audio("incorrect","assets/mp3/incorrect.mp3"),this.load.image("bg","assets/img/start/start_bg.png"),this.load.image("start_title","assets/img/start/start_title.png"),this.load.image("start_char","assets/img/start/start_char.png"),this.load.image("start_btn","assets/img/start/start_btn.png"),this.load.image("start_btn_h","assets/img/start/start_btn_h.png"),this.load.image("how_btn","assets/img/start/how_btn.png"),this.load.image("how_btn_h","assets/img/start/how_btn_h.png"),this.load.image("help_next_btn","assets/img/help/help_next_btn.png"),this.load.image("help_next_btn_h","assets/img/help/help_next_btn_h.png"),this.load.image("help_prev_btn","assets/img/help/help_prev_btn.png"),this.load.image("help_prev_btn_h","assets/img/help/help_prev_btn_h.png"),this.load.image("close_btn","assets/img/help/close_btn.png"),this.load.image("close_btn_h","assets/img/help/close_btn_h.png"),this.load.image("help_1","assets/img/help/help_1.png"),this.load.image("help_2","assets/img/help/help_2.png"),this.load.image("help_3","assets/img/help/help_3.png"),this.load.image("help_4","assets/img/help/help_4.png"),this.load.image("help_text_1","assets/img/help/help_text_1.png"),this.load.image("help_text_2","assets/img/help/help_text_2.png"),this.load.image("help_text_3","assets/img/help/help_text_3.png"),this.load.image("help_text_4","assets/img/help/help_text_4.png"),this.load.image("hexagon","assets/img/play/hexagon.png"),this.load.image("limit","assets/img/play/limit.png"),this.load.image("my_hexagon","assets/img/play/hexagon_h.png"),this.load.spritesheet("player","assets/img/play/player.png",{frameWidth:60,frameHeight:40}),this.load.image("enemy","assets/img/play/enemy.png"),this.load.image("enemy_freeze","assets/img/play/enemy_freeze.png"),this.load.image("item_freeze","assets/img/play/freeze.png"),this.load.image("item_speed","assets/img/play/speed.png"),this.load.image("item_invincible","assets/img/play/invincible.png"),this.load.spritesheet("buster_effect","assets/img/play/buster_effect.png",{frameWidth:200,frameHeight:200}),this.load.spritesheet("shield_effect","assets/img/play/shield_effect.png",{frameWidth:200,frameHeight:200}),this.load.spritesheet("bee_over_1","assets/img/over/bee_over_1.png",{frameWidth:456,frameHeight:300}),this.load.spritesheet("bee_over_2","assets/img/over/bee_over_2.png",{frameWidth:456,frameHeight:300}),this.load.spritesheet("bee_over_3","assets/img/over/bee_over_3.png",{frameWidth:456,frameHeight:300}),this.load.spritesheet("bee_over_4","assets/img/over/bee_over_4.png",{frameWidth:456,frameHeight:300}),this.load.spritesheet("bee_over_5","assets/img/over/bee_over_5.png",{frameWidth:456,frameHeight:300}),this.load.image("game_over_balloon","assets/img/over/over_ballon.png"),this.load.image("game_over_text_box","assets/img/over/over_text_box.png"),this.load.image("hit_trail_text","assets/img/over/hit_trail_text.png"),this.load.image("hit_enemy_text","assets/img/over/hit_enemy_text.png"),this.load.image("enemy_hit_trail_text","assets/img/over/enemy_hit_trail_text.png"),this.load.image("medal_bg","assets/img/medal/medal_bg.png"),this.load.spritesheet("bee_medal","assets/img/medal/bee_medal.png",{frameWidth:138,frameHeight:229}),this.load.spritesheet("return_button","assets/img/button/return_button.png",{frameWidth:215.5,frameHeight:103}),this.load.spritesheet("home_button","assets/img/button/home_button.png",{frameWidth:72,frameHeight:74}),this.load.spritesheet("reset_button","assets/img/button/reset_button.png",{frameWidth:218,frameHeight:105}),this.load.spritesheet("volume_button","assets/img/button/volume_button.png",{frameWidth:72,frameHeight:73}),this.load.spritesheet("mute_button","assets/img/button/mute_button.png",{frameWidth:72,frameHeight:73}),this.load.spritesheet("start_button","assets/img/button/start_button.png",{frameWidth:231,frameHeight:106}),this.load.image("quiz_start","assets/img/map/quiz_start.png"),this.load.image("quiz_start_h","assets/img/map/quiz_start_h.png"),this.load.image("mini_medal_1","assets/img/map/mini_medal_1.png"),this.load.image("mini_medal_2","assets/img/map/mini_medal_2.png"),this.load.image("mini_medal_3","assets/img/map/mini_medal_3.png"),this.load.image("mini_medal_4","assets/img/map/mini_medal_4.png"),this.load.image("map_bg","assets/img/quiz/map_bg.png"),this.load.image("minimap_bg","assets/img/map/minimap_bg.png"),this.load.image("quiz_bg","assets/img/quiz/quiz_bg.png"),this.load.image("word_bg","assets/img/quiz/word_bg.png"),this.load.image("word_bg_h","assets/img/quiz/word_bg_h.png"),this.load.image("text_incorrect","assets/img/quiz/text_incorrect.png"),this.load.image("text_1","assets/img/quiz/text_1.png"),this.load.image("text_2","assets/img/quiz/text_2.png"),this.load.image("text_3","assets/img/quiz/text_3.png"),this.load.image("text_4","assets/img/quiz/text_4.png"),this.load.spritesheet("incorrect_1","assets/img/quiz/incorrect_1.png",{frameWidth:355.2,frameHeight:448}),this.load.spritesheet("incorrect_2","assets/img/quiz/incorrect_2.png",{frameWidth:355.2,frameHeight:448}),this.load.spritesheet("incorrect_3","assets/img/quiz/incorrect_3.png",{frameWidth:355.2,frameHeight:448}),this.load.spritesheet("incorrect_4","assets/img/quiz/incorrect_4.png",{frameWidth:355.2,frameHeight:448}),this.load.spritesheet("incorrect_5","assets/img/quiz/incorrect_5.png",{frameWidth:355.2,frameHeight:448}),this.load.image("medal_1","assets/img/quiz/medal_1.png"),this.load.spritesheet("medal_1_1","assets/img/quiz/medal_1_1.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_1_2","assets/img/quiz/medal_1_2.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_1_3","assets/img/quiz/medal_1_3.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_1_4","assets/img/quiz/medal_1_4.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_1_5","assets/img/quiz/medal_1_5.png",{frameWidth:506.5,frameHeight:592}),this.load.image("medal_2","assets/img/quiz/medal_2.png"),this.load.spritesheet("medal_2_1","assets/img/quiz/medal_2_1.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_2_2","assets/img/quiz/medal_2_2.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_2_3","assets/img/quiz/medal_2_3.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_2_4","assets/img/quiz/medal_2_4.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_2_5","assets/img/quiz/medal_2_5.png",{frameWidth:506.5,frameHeight:592}),this.load.image("medal_3","assets/img/quiz/medal_3.png"),this.load.spritesheet("medal_3_1","assets/img/quiz/medal_3_1.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_3_2","assets/img/quiz/medal_3_2.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_3_3","assets/img/quiz/medal_3_3.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_3_4","assets/img/quiz/medal_3_4.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_3_5","assets/img/quiz/medal_3_5.png",{frameWidth:506.5,frameHeight:592}),this.load.image("medal_4","assets/img/quiz/medal_4.png"),this.load.spritesheet("medal_4_1","assets/img/quiz/medal_4_1.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_4_2","assets/img/quiz/medal_4_2.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_4_3","assets/img/quiz/medal_4_3.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_4_4","assets/img/quiz/medal_4_4.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_4_5","assets/img/quiz/medal_4_5.png",{frameWidth:506.5,frameHeight:592}),this.load.image("main_btn","assets/img/quiz/mainPage_btn.png"),this.load.image("main_btn_h","assets/img/quiz/mainPage_btn_h.png"),this.load.image("next_btn","assets/img/quiz/next_btn.png"),this.load.image("next_btn_h","assets/img/quiz/next_btn_h.png"),this.load.image("exit_btn","assets/img/quiz/exit_btn.png"),this.load.image("exit_btn_h","assets/img/quiz/exit_btn_h.png")}create(){this.initBgm(),this.time.delayedCall(500,()=>{this.scene.start("StartScene")})}initBgm(){P.init(this,"bgm_audio",{loop:!0,volume:.05})}}const k=(g,e=0,t=.7)=>{const{width:s,height:i}=g.sys.game.config;return g.add.rectangle(0,0,s,i,e,t).setOrigin(0,0).setDepth(0)},M=(g,e,t)=>{const s=`${e}_h`,i=g.scene;!i.textures.exists(e)||!i.textures.exists(s)||(g.on("pointerover",()=>g.setTexture(s)),g.on("pointerout",()=>g.setTexture(e)))},E=g=>{g.on("pointerover",()=>g.setFrame(1)),g.on("pointerout",()=>g.setFrame(0))},B=g=>g<=5?1:g<=15?2:g<=30?3:4,_={TITLE:{x:640,y:200,scale:.6},CHAR:{x:600,y:450,scale:.6},START_BTN:{x:640,y:630,scale:.6667},HOW_BTN:{x:1180,y:100,scale:.6667}};class Q extends Phaser.Scene{constructor(){super("StartScene")}create(){this.initScene(),this.createBackground(),this.createUI(),this.createButtons()}initScene(){this.registry.set("myMedals",{1:0,2:0,3:0,4:0}),["PlayScene","QuizScene","GameOverScene","MedalScene"].forEach(e=>this.scene.stop(e))}createBackground(){const{width:e,height:t}=this.sys.game.config,s=this.add.image(0,0,"bg").setOrigin(0),i=Math.max(e/s.width,t/s.height);s.setScale(i).setScrollFactor(0)}createUI(){const e=this.add.image(_.TITLE.x,_.TITLE.y-50,"start_title").setScale(_.TITLE.scale),t=this.add.image(_.CHAR.x+200,_.CHAR.y-50,"start_char").setScale(_.CHAR.scale*.5);this.tweens.add({targets:e,y:_.TITLE.y,ease:"Sine.easeInOut",duration:800,yoyo:!1}),this.tweens.add({targets:t,scale:_.CHAR.scale,x:_.CHAR.x,y:_.CHAR.y,ease:"Sine.easeInOut",duration:800,yoyo:!1})}createButtons(){this.createStartButton(),this.createHowToPlayButton()}createStartButton(){const e=this.add.sprite(_.START_BTN.x,_.START_BTN.y,"start_btn",0).setInteractive({useHandCursor:!0}).setScale(_.START_BTN.scale);e.on("pointerdown",()=>{this.sound.play("click"),this.cameras.main.fadeOut(200,255,255,255),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("PlayScene",{showMedalOnStart:!0})})}),M(e,"start_btn")}createHowToPlayButton(){const e=this.add.sprite(_.HOW_BTN.x,_.HOW_BTN.y,"how_btn",0).setInteractive({useHandCursor:!0}).setScale(_.HOW_BTN.scale);e.on("pointerdown",()=>this.scene.launch("HelpScene")),M(e,"how_btn")}}const y={width:64,height:55},R={width:1280,height:720},q={col:62,row:53},b={width:(q.col-1)*(y.width*.75)+y.width,height:(q.row-1)*y.height+y.height},x=.6667,V=150,Y=5,X=10,$=10,U="0x5092FF",Z=30,K=60,J=100,j=10,C="Cafe24Surround",ee="Eommakkaturi",te="MaplestoryBold",A={DOT_INACTIVE:9206321,DOT_ACTIVE:16767813};class se extends Phaser.Scene{constructor(){super("HelpScene")}create(){this.initScene(),this.createUI(),this.createPages(),this.showPage(0)}initScene(){const{width:e,height:t}=this.sys.game.config;this.centerX=e/2,this.centerY=t/2,this.pages=[],this.pageIndicators=[],this.totalPages=4,this.currentPage=0}createUI(){k(this).setInteractive(),this.createNavigation(),this.createPageIndicator(),this.createCloseButton()}createPages(){for(let e=0;e<this.totalPages;e++){const t=this.add.container(0,0).setVisible(!1),s=this.add.image(this.centerX,this.centerY-50,`help_${e+1}`).setScale(x),i=this.add.image(this.centerX,this.sys.game.config.height-120,`help_text_${e+1}`).setScale(x);t.add([s,i]),this.pages.push(t)}}createCloseButton(){const e=this.add.image(0,0,"close_btn").setScale(x).setPosition(this.sys.game.config.width-50,50).setInteractive({useHandCursor:!0});M(e,"close_btn"),e.on("pointerdown",()=>this.scene.stop())}createNavigation(){const e=this.add.image(0,0,"help_prev_btn").setScale(x).setPosition(50,this.centerY).setInteractive({useHandCursor:!0});M(e,"help_prev_btn");const t=this.add.image(0,0,"help_next_btn").setScale(x).setPosition(this.sys.game.config.width-50,this.centerY).setInteractive({useHandCursor:!0});M(t,"help_next_btn"),e.on("pointerdown",()=>this.prevPage()),t.on("pointerdown",()=>this.nextPage())}createPageIndicator(){this.pageIndicators=[];for(let e=0;e<this.totalPages;e++){const t=this.centerX+(e-(this.totalPages-1)/2)*30,s=this.sys.game.config.height-30,i=this.add.circle(t,s,8,A.DOT_INACTIVE).setScale(x).setInteractive({useHandCursor:!0}),a=this.add.graphics().setPosition(t,s).fillStyle(A.DOT_ACTIVE,1).fillRoundedRect(-20,-8,40,16,8).setScale(x).setVisible(!1).setDepth(2);this.pageIndicators.push({circle:i,graphics:a}),i.on("pointerdown",()=>this.showPage(e))}}updatePageIndicators(e){this.pageIndicators.forEach((t,s)=>{const i=s===e;t.circle.setVisible(!i),t.graphics.setVisible(i)})}showPage(e){this.pages.forEach((t,s)=>t.setVisible(s===e)),this.currentPage=e,this.updatePageIndicators(e)}nextPage(){const e=(this.currentPage+1)%this.totalPages;this.showPage(e)}prevPage(){const e=(this.currentPage-1+this.totalPages)%this.totalPages;this.showPage(e)}}const ie=[{answer:"banana",quizImage:"assets/img/play/world/banana.png",options:["bread","banana","potato"]},{answer:"diamond",quizImage:"assets/img/play/world/diamond.png",options:["ice","diamond","mountain"]},{answer:"duck",quizImage:"assets/img/play/world/duck.png",options:["duck","snake","rabbit"]},{answer:"fan",quizImage:"assets/img/play/world/fan.png",options:["fan","net","basket"]},{answer:"sandwich",quizImage:"assets/img/play/world/sandwich.png",options:["cake","cutlet","sandwich"]},{answer:"scissors",quizImage:"assets/img/play/world/scissors.png",options:["clock","scissors","skate shoes"]},{answer:"umbrella",quizImage:"assets/img/play/world/umbrella.png",options:["glass","spider","umbrella"]},{answer:"pencil",quizImage:"assets/img/play/world/pencil.png",options:["wood","cookie","pencil"]},{answer:"ant",quizImage:"assets/img/play/world/ant.png",options:["scorpion","ant","butterfly"]},{answer:"book",quizImage:"assets/img/play/world/book.png",options:["sun","gold","book"]}];class ae{constructor({scene:e,properties:t}){this.scene=e,this.hexagonList=[],this.hexagonMap=new Map,this.answer=t.answer,this.tileWidth=y.width*.75,this.tileHeight=y.height,this.radiusByWidth=b.width/this.tileWidth/2,this.radiusByHeight=b.height/this.tileHeight/2,this.mapRadius=Math.floor(Math.min(this.radiusByWidth,this.radiusByHeight))-1,this.init()}init(){this.initQuizBg(),this.createHexagon(),this.createHexMask(),this.createQuizMask()}createQuizMask(){if(this.quizMaskGraphics=this.scene.make.graphics({add:!1}),this.updateQuizMask(),this.quizBg){const e=new Phaser.Display.Masks.GeometryMask(this.scene,this.quizMaskGraphics);this.quizBg.setMask(e)}}updateQuizMask(){if(this.quizMaskGraphics){this.quizMaskGraphics.clear();for(const e of this.hexagonList){if(e.texture&&e.texture.key!=="my_hexagon")continue;const t=e.x,s=e.y,i=this.getHexPoints(t,s,y.width,y.height);this.quizMaskGraphics.fillStyle(16777215,1),this.quizMaskGraphics.beginPath(),this.quizMaskGraphics.moveTo(i[0],i[1]);for(let a=2;a<i.length;a+=2)this.quizMaskGraphics.lineTo(i[a],i[a+1]);this.quizMaskGraphics.closePath(),this.quizMaskGraphics.fillPath()}}}initQuizBg(){this.quizBg=this.scene.add.image(b.width/2,b.height/2,this.answer).setDepth(0).setVisible(!0),this.bgDim=this.scene.add.graphics(),this.bgDim.fillStyle(0,.45).fillRect(0,0,b.width,b.height).setDepth(-10)}createHexMask(){const e=this.scene.make.graphics({add:!1});this.hexagonList.forEach(s=>{const{x:i,y:a,texture:n}=s;if(n.key==="limit")return;const o=this.getHexPoints(i,a,y.width,y.height),r=new Phaser.Geom.Polygon(o);e.fillPoints(r.points,!0)});const t=new Phaser.Display.Masks.GeometryMask(this.scene,e);this.bgDim.setMask(t)}createHexagon(){const e=Math.ceil((b.width+y.width)/this.tileWidth),t=Math.ceil((b.height+y.height/2)/y.height),s={col:Math.floor(e/2),row:Math.floor(t/2)},i=this.offsetToCube(s.col,s.row),a=(e-1)*this.tileWidth+y.width,n=(t-1)*y.height+y.height,o=b.width/2-a/2,r=b.height/2-n/2-25;for(let h=-1;h<e;h++)for(let l=-1;l<t;l++){const c=this.offsetToCube(h,l),m=this.getCubeDistance(i,c);if(m>this.mapRadius+1)continue;const p=h%2!==0,d=h*this.tileWidth+y.width/2+o,u=l*y.height+(p?y.height/2:0)+y.height/2+r,w=m>this.mapRadius?"limit":"hexagon",f=this.scene.add.image(d,u,w).setOrigin(.5);w==="hexagon"&&f.setAlpha(1),f.col=h,f.row=l,this.hexagonList.push(f),this.hexagonMap.set(`${h},${l}`,f)}}createRandomStartTerritory(){const e=this.hexagonList.filter(s=>this.getAroundTiles(s.col).every(i=>{const a=this.hexagonMap.get(`${s.col+i[0]},${s.row+i[1]}`);return a&&a.texture.key!=="limit"})),t=Phaser.Utils.Array.GetRandom(e);return t?([t,...this.getAroundTiles(t.col).map(s=>this.hexagonMap.get(`${t.col+s[0]},${t.row+s[1]}`)).filter(Boolean)].forEach(s=>s.setTexture("my_hexagon")),this.updateQuizMask&&this.updateQuizMask(),t):null}getAroundTiles(e){return e%2!==0?[[0,-1],[0,1],[-1,0],[1,0],[-1,1],[1,1]]:[[0,-1],[0,1],[-1,-1],[1,-1],[-1,0],[1,0]]}offsetToCube(e,t){const s=e,i=t-(e-(e&1))/2,a=-s-i;return{x:s,y:a,z:i}}getCubeDistance(e,t){return(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)+Math.abs(e.z-t.z))/2}getHexPoints(e,t,s,i){return[e-s/2,t,e-s/4,t-i/2,e+s/4,t-i/2,e+s/2,t,e+s/4,t+i/2,e-s/4,t+i/2]}}class I{static getFittedSize(e,t,s,i){const a=e/t;let n=s,o=n/a;return o>i&&(o=i,n=o*a),{w:n,h:o}}constructor(e){this.scene=e,this.minimapCam=null,this.quizButton=null,this.medalIcon=null,this.createMinimap()}createMinimap(){const e=this.scene,t=10,s=250,i=250,a=188,n=e.world.w,o=e.world.h,{w:r,h}=I.getFittedSize(n,o,s,i),l=e.scale.width-r-t,c=t,m=r/n,p=e.add.image(l+14,a,"minimap_bg").setOrigin(0).setScrollFactor(0).setScale(.65).setDepth(998);if(this.minimapCam=e.cameras.add(l,c,r,h).setBounds(0,0,n,o).setZoom(m).setName("minimap"),this.createQuizButtonAndMedal(),e.hexagonList&&Array.isArray(e.hexagonList)){const d=e.hexagonList.filter(u=>u.texture&&u.texture.key==="hexagon");this.minimapCam.ignore([...d,p,this.quizButton,this.medalIcon])}e.medalIcon=this.medalIcon}createQuizButtonAndMedal(){const t=this.scene,s=1182,i=298;this.quizButton=t.add.image(s,i,"quiz_start").setScale(.6667).setScrollFactor(0).setDepth(9999).setInteractive({useHandCursor:!0}),M(this.quizButton,"quiz_start"),this.quizButton.on("pointerdown",this.snapshot,this);const n=`mini_medal_${B(this.hexagonPercent())}`,o=1082,r=i;this.medalIcon=t.add.image(o,r,n).setScale(.6667).setScrollFactor(0).setDepth(9999)}snapshot(){const e=this.scene,t=e.cameras.main;e.scene.pause(),document.querySelector("canvas").style.opacity="0";const s=e.itemManager?.items||e.items,i=e.activeEffects||[],a=[e.player,e.enemies,this.minimapCam,this.quizButton,s,e.trailGraphics,...i],n=e.stage.hexagonList.filter(d=>d.visible!==!1),o=[e.stage.bgDim];[...a,...n,...o].forEach(d=>d&&d.setVisible(!1));let r=e.stage&&e.stage.quizBg,h=null;r&&r.mask&&(h=r.mask,r.setMask(null));const l=t.zoom,c=e.canvasSize.w/e.world.w,m=e.canvasSize.h/e.world.h,p=Math.min(c,m);t.stopFollow().setZoom(p).setScroll(0,0),e.game.renderer.snapshot(d=>{r&&h&&r.setMask(h),e.stage.hexagonList.filter(f=>f.texture.key==="hexagon").forEach(f=>f.setVisible(!0));const w=e.stage.hexagonList.filter(f=>f.visible!==!1&&f.texture.key!=="hexagon");[...a,...w,...o].forEach(f=>f&&f.setVisible(!1)),setTimeout(()=>{e.game.renderer.snapshot(f=>{[...a,...n,...o].forEach(z=>z&&z.setVisible(!0)),t.setZoom(l).startFollow(e.player),e.textures.exists("worldSnapshot")&&e.textures.remove("worldSnapshot"),e.textures.exists("worldSnapshotNoHexagon")&&e.textures.remove("worldSnapshotNoHexagon"),e.textures.addImage("worldSnapshot",f),e.textures.addImage("worldSnapshotNoHexagon",d),e.scene.launch("QuizScene",{quiz:e.quiz,allQuizzes:e.allQuizzes,canvasSize:e.canvasSize,medalNumber:B(this.hexagonPercent())})})},0)})}hexagonPercent(){const e=this.scene.hexagonList,t=e.filter(i=>i.texture.key!=="limit").length,s=e.filter(i=>i.texture.key==="my_hexagon").length;return t===0?0:Math.floor(s/t*100)}updateMedal(){if(this.medalIcon){const t=`mini_medal_${B(this.hexagonPercent())}`;this.medalIcon.setTexture(t)}}}const ne=60,re=200,he=50,O=12,oe=200,le=200,ce=[160,260],de=[120,220];function S(g,e,t){const s=g.getNearestHexagon(e,t);return!s||s.texture.key==="limit"||g.isOnMyHexagon(e,t)?!1:!g.hexagonList.filter(a=>Phaser.Math.Distance.Between(a.x,a.y,s.x,s.y)<ne&&a!==s).some(a=>a.texture?.key==="limit")}class me{constructor(e){this.scene=e,this.config={enemyGroup:e.enemies,enemyRadius:e.enemyRadius,enemyRange:e.enemyRange,enemySpeed:e.enemySpeed,canvasSize:e.canvasSize,world:e.world,player:()=>e.player,hexagonList:e.hexagonList},this.bounds={minX:e.canvasSize.w/2,minY:e.canvasSize.h/2,maxX:e.world.w,maxY:e.world.h}}pickPattern(){return Phaser.Math.RND.pick(["LR","APPROACH","UD","APPROACH","CIRCLE","RECT","APPROACH"])}spawnEnemySimple(e=this.pickPattern()){const t=this.config,s=this.bounds;if(!t.enemyGroup)return;let i,a,n=0,o=!1;for(;!o&&n<he;){i=Phaser.Math.Between(s.minX,s.maxX),a=Phaser.Math.Between(s.minY,s.maxY);const r=Phaser.Math.Distance.Between(i,a,t.player().x,t.player().y);S(this.scene,i,a)&&r>re&&(o=!0),n++}if(o){const r=t.enemyGroup.create(i,a,"enemy");return r.setSize(t.enemyRadius*2,t.enemyRadius*2),r.setScale(.7),r.setDepth(1),this.startPattern(r,e),r}return null}startPattern(e,t){const s=this.bounds;if(!(!e||!e.active||e.pendingRemoval))switch(t){case"LR":return this.startLR(e,s.minX,s.maxX);case"UD":return this.startUD(e,s.minY,s.maxY);case"CIRCLE":return this.startCircle(e,s.minX,s.maxX,s.minY,s.maxY);case"APPROACH":return this.startApproach(e,s.minX,s.maxX,s.minY,s.maxY);default:return this.startRect(e,s.minX,s.maxX,s.minY,s.maxY)}}nextPattern(e){!e||!e.active||e.pendingRemoval||this.startPattern(e,this.pickPattern())}go(e,t,s){const i=this.config;if(!e||!e.active||e.pendingRemoval)return;const a=Phaser.Math.Distance.Between(e.x,e.y,t.x,t.y),n=Math.max(50,a/(i.enemySpeed||90)*1e3);this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,x:t.x,y:t.y,duration:n,ease:"Linear",onComplete:s})}chain(e,t,s){let i=0;const a=()=>{if(!e||!e.active||e.pendingRemoval)return;if(i>=t.length){s&&s();return}const n=t[i++];this.go(e,n,a)};a()}startLR(e,t,s){const i=this.config,a=Math.floor((i.enemyRange||oe)/2),n=Phaser.Math.Clamp(e.x-a,t,s),o=Phaser.Math.Clamp(e.x+a,t,s),r=[];if(S(this.scene,n,e.y)&&r.push({x:n,y:e.y}),S(this.scene,o,e.y)&&r.push({x:o,y:e.y}),r.length<2)return this.nextPattern(e);const l=Math.abs(e.x-n)<=Math.abs(e.x-o)?r:r.slice().reverse();this.chain(e,l,()=>this.nextPattern(e))}startUD(e,t,s){const i=this.config,a=Math.floor((i.enemyRange||le)/2),n=Phaser.Math.Clamp(e.y-a,t,s),o=Phaser.Math.Clamp(e.y+a,t,s),r=[];if(S(this.scene,e.x,n)&&r.push({x:e.x,y:n}),S(this.scene,e.x,o)&&r.push({x:e.x,y:o}),r.length<2)return this.nextPattern(e);const l=Math.abs(e.y-n)<=Math.abs(e.y-o)?r:r.slice().reverse();this.chain(e,l,()=>this.nextPattern(e))}startCircle(e,t,s,i,a){const n=Phaser.Math.Between(80,140),o=Math.min(e.x-t,s-e.x,e.y-i,a-e.y),r=Math.max(20,Math.min(n,o)),h=e.x,l=e.y,c=[];for(let m=1;m<=O;m++){const p=2*Math.PI*m/O,d=h+r*Math.cos(p),u=l+r*Math.sin(p);S(this.scene,d,u)&&c.push({x:d,y:u})}if(c.length<3)return this.nextPattern(e);this.chain(e,c,()=>this.nextPattern(e))}startRect(e,t,s,i,a){this.config;const n=Math.floor(Phaser.Math.Between(...ce)/2),o=Math.floor(Phaser.Math.Between(...de)/2),r=Phaser.Math.Clamp(e.x-n,t,s),h=Phaser.Math.Clamp(e.x+n,t,s),l=Phaser.Math.Clamp(e.y-o,i,a),c=Phaser.Math.Clamp(e.y+o,i,a),m=[];if(S(this.scene,r,l)&&m.push({x:r,y:l}),S(this.scene,h,l)&&m.push({x:h,y:l}),S(this.scene,h,c)&&m.push({x:h,y:c}),S(this.scene,r,c)&&m.push({x:r,y:c}),m.length<3)return this.nextPattern(e);this.chain(e,m,()=>this.nextPattern(e))}startApproach(e,t,s,i,a){const n=this.config;if(!e||!e.active||e.pendingRemoval)return;const o=n.player();if(!o)return this.nextPattern(e);const r=o.x-e.x,h=o.y-e.y,l=Math.hypot(r,h);if(l<1)return this.nextPattern(e);const c=Math.min(n.enemyRange||100,l),m=r/l,p=h/l;let d=e.x+m*c,u=e.y+p*c;d=Phaser.Math.Clamp(d,t,s),u=Phaser.Math.Clamp(u,i,a),this.go(e,{x:d,y:u},()=>this.nextPattern(e))}}class ge{constructor(e){this.scene=e,this.items=e.physics.add.group(),this.activeTimers=[],this.itemTypes=["freeze","speed","invincible"]}start(){this.itemTimer=this.scene.time.addEvent({delay:7e3,callback:()=>this.spawnItem(),callbackScope:this,loop:!0}),this.activeTimers.push(this.itemTimer)}shutdown(){this.activeTimers.forEach(e=>e&&e.remove()),this.activeTimers=[],this.items.getChildren().forEach(e=>e&&e.destroy())}spawnItem(){const e=this.scene,t=Phaser.Math.RND.pick(this.itemTypes),s=this.items.getChildren?this.items.getChildren():[],i=e.hexagonList;let a=null;for(let o=0;o<30;o++){const r=Phaser.Math.RND.pick(i);if(r.texture?.key==="limit"||e.isOnMyHexagon(r.x,r.y))continue;if(!s.some(l=>{const c=(l.x??0)-r.x,m=(l.y??0)-(r.y-10);return Math.sqrt(c*c+m*m)<30})){a=r;break}}if(!a)return;const n=this.items.create(a.x,a.y-10,`item_${t}`);n.setScale(.53),n.itemType=t,e.time.delayedCall(3e4,()=>{n.active&&n.destroy()},[],this)}eatItem(e,t){this.applyItemEffect(t),t.destroy()}applyItemEffect(e){switch(e.itemType){case"freeze":this.freezeEnemies(1e4);break;case"speed":this.boostPlayerSpeed(1e4,100);break;case"invincible":this.makePlayerInvincible(1e4);break}}freezeEnemies(e){const t=this.scene;if(t.enemyFrozen){t.time.delayedCall(e,()=>this.unfreezeEnemies(),[],this);return}t.enemyFrozen=!0,t.spawnTimer&&(t.spawnTimer.paused=!0);const s=t.enemies.getChildren();for(const i of s)t.tweens.killTweensOf(i),i.setVelocity(0),i.setTexture("enemy_freeze"),t.frozenEnemies.add(i);t.time.delayedCall(e,()=>this.unfreezeEnemies(),[],this)}unfreezeEnemies(){this.scene.enemyFrozen=!1;for(const e of this.scene.frozenEnemies)e&&e.active&&(e.setTexture("enemy"),this.scene.enemyManager.startPattern(e,this.scene.enemyManager.pickPattern()));this.scene.frozenEnemies.clear(),this.scene.time.delayedCall(0,()=>this.scene.cullEnemiesOnMyHex()),this.scene.spawnTimer&&(this.scene.spawnTimer.paused=!1)}boostPlayerSpeed(e,t){const s=this.scene;if(s.speedBoostTimer){const i=s.speedBoostTimer.getRemaining();s.speedBoostTimer.remove(),e+=i}s.speedBoostTimer&&s.speedBoostTimer.remove(),s.playerSpeed=s.originalPlayerSpeed+t,s.anims.exists("speed_effect")||s.anims.create({key:"speed_effect",frames:s.anims.generateFrameNumbers("buster_effect",{start:0,end:41}),frameRate:15,repeat:-1}),s.speedEffect||(s.speedEffect=s.add.sprite(s.player.x,s.player.y,"buster_effect"),s.speedEffect.setDepth(s.player.depth-1),s.activeEffects.push(s.speedEffect)),s.speedEffect.setVisible(!0),s.speedEffect.play("speed_effect",!0),s.speedBoostTimer=s.time.delayedCall(e,()=>{s.playerSpeed=s.originalPlayerSpeed,s.player.setTexture("player"),s.speedEffect&&s.speedEffect.setVisible(!1)},[],s),s.activeTimers.push(s.speedBoostTimer)}makePlayerInvincible(e){const t=this.scene;t.shieldEffectTimer&&t.shieldEffectTimer.remove(),t.isInvincible=!0,t.anims.exists("shield_effect")||t.anims.create({key:"shield_effect",frames:t.anims.generateFrameNumbers("shield_effect",{start:0,end:33}),frameRate:20,repeat:-1}),t.shieldEffect||(t.shieldEffect=t.add.sprite(t.player.x,t.player.y,"shield_effect"),t.shieldEffect.setDepth(2),t.activeEffects.push(t.shieldEffect)),t.shieldEffect.setVisible(!0),t.shieldEffect.play("shield_effect",!0),t.shieldEffectTimer=t.time.delayedCall(e,()=>{t.isInvincible=!1,t.player.setTexture("player"),t.shieldEffect&&t.shieldEffect.setVisible(!1)},[],t),t.activeTimers.push(t.shieldEffectTimer)}}class pe extends Phaser.Scene{constructor(){super("PlayScene"),this.quizData=ie}init(e={}){this.allQuizzes=e.allQuizzes||this.quizData,this.quiz=e.quiz||Phaser.Utils.Array.GetRandom(this.allQuizzes),this.showMedalOnStart=e.showMedalOnStart||!1,this.initGameState()}preload(){this.load.image(this.quiz.answer,this.quiz.quizImage)}create(){this.cameras.main.setBackgroundColor("#E0C180"),this.initStage(),this.trailGraphics=this.add.graphics().setDepth(0),this.trailPath=[],this.anims.exists("player_fly")||this.anims.create({key:"player_fly",frames:this.anims.generateFrameNumbers("player",{start:0,end:2}),frameRate:10,repeat:-1}),this.player=this.physics.add.sprite(this.playerStartTile.x,this.playerStartTile.y,"player"),this.player.play("player_fly"),this.player.setCollideWorldBounds(!0),this.player.setDepth(1),this.physics.world.setBounds(0,0,this.world.w,this.world.h),this.cameras.main.setBounds(0,0,this.world.w,this.world.h),this.cameras.main.startFollow(this.player),this.dir=new Phaser.Math.Vector2(1,0),this.player.setVelocity(this.dir.x*this.playerSpeed,this.dir.y*this.playerSpeed),this.enemies=this.physics.add.group({collideWorldBounds:!0}),this.enemyManager=new me(this),this.activeTimers=[],this.activeEffects=[];for(let e=0;e<this.enemyCount;e++)this.enemyManager.spawnEnemySimple();this.spawnTimer=this.time.addEvent({delay:3e3,callback:()=>this.enemyManager.spawnEnemySimple(),callbackScope:this,loop:!0}),this.activeTimers.push(this.spawnTimer),this.itemManager=new ge(this),this.itemManager.start(),this.miniMap=new I(this),this.physics.add.overlap(this.player,this.enemies,()=>!this.isInvincible&&this.gameOver("hit_enemy")),this.physics.add.overlap(this.player,this.itemManager.items,(e,t)=>this.itemManager.eatItem(e,t),null,this),this.showMedalOnStart&&(this.scene.pause(),this.scene.launch("MedalScene",{remainingQuizzes:this.allQuizzes}))}update(){if(this.playerMoving(),this.updateTrailPath(),this.activeEffects.forEach(e=>{e&&e.visible&&(e.x=this.player.x,e.y=this.player.y)}),!this.isInvincible&&this.checkSelfTrailCollision(this.player)){this.gameOver("hit_trail");return}!this.isInvincible&&this.checkEnemiesHitTrail()||(this.cullEnemiesOnMyHex(),this.miniMap&&this.miniMap.updateMedal())}initStage(){this.stage=new ae({scene:this,properties:{answer:this.quiz.answer}}),this.playerStartTile=this.stage.createRandomStartTerritory(),this.hexagonList=this.stage.hexagonList}drawHexBorder(e,t,s=5280511,i=4){const a=this.hexagonSize.w,n=this.hexagonSize.h,o=a/2,r=n/2,h=[{x:e-o,y:t},{x:e-o/2,y:t-r},{x:e+o/2,y:t-r},{x:e+o,y:t},{x:e+o/2,y:t+r},{x:e-o/2,y:t+r},{x:e-o,y:t}];this.trailGraphics.lineStyle(i,s,1),this.trailGraphics.beginPath(),this.trailGraphics.moveTo(h[0].x,h[0].y);for(let l=1;l<h.length;l++)this.trailGraphics.lineTo(h[l].x,h[l].y);this.trailGraphics.strokePath()}initGameState(){this.isGameOver=!1,this.world={w:b.width,h:b.height},this.canvasSize={w:R.width,h:R.height},this.hexagonSize={w:y.width,h:y.height},this.hexagonList=[],this.playerSpeed=V,this.turnEase=Y,this.isDrawing=!1,this.interval=X,this.trailWidth=$,this.trailColor=U,this.isInvincible=!1,this.invincibilityTimer=null,this.originalPlayerSpeed=this.playerSpeed,this.speedBoostTimer=null,this.enemies=null,this.enemyCount=Z,this.enemySpeed=K,this.enemyRange=J,this.enemyRadius=j,this.enemyFrozen=!1,this.frozenEnemies=new Set,this.freezeTimer=null,this.items=null,this.speedEffect=null,this.shieldEffect=null,this.activeEffects=[]}shutdown(){this.activeTimers&&(this.activeTimers.forEach(e=>e&&e.remove()),this.activeTimers=[]),this.activeEffects&&(this.activeEffects.forEach(e=>e&&e.destroy()),this.activeEffects=[])}findInnerHoles(e=!0){if(!Array.isArray(this.hexagonList)||!this.hexagonList.length)return[];const t=(h,l)=>`${h},${l}`,s=new Map;for(const h of this.hexagonList)!h||h.col==null||h.row==null||s.set(t(h.col,h.row),h);const i=(h,l,c)=>s.get(t(h.col+l,h.row+c))||null,a=h=>h%2===0?[[0,-1],[0,1],[-1,-1],[1,-1],[-1,0],[1,0]]:[[0,-1],[0,1],[-1,0],[1,0],[-1,1],[1,1]],n=h=>!!h&&h.texture?.key!=="my_hexagon"&&h.texture?.key!=="limit",o=new Set,r=[];for(const h of this.hexagonList){if(!n(h))continue;const l=t(h.col,h.row);if(o.has(l))continue;const c=[],m=[h];o.add(l);let p=!1;for(;m.length;){const d=m.shift();c.push(d);for(const[u,w]of a(d.col)){const f=i(d,u,w);if(!f){p=!0;continue}if(f.texture?.key==="limit"){p=!0;continue}if(n(f)){const z=t(f.col,f.row);o.has(z)||(o.add(z),m.push(f))}}}p||(e&&c.forEach(d=>this.markAsMyHexagon(d)),r.push(c))}return r}playerMoving(){if(!this.player||!this.player.body)return;const e=this.input.activePointer,t=this.cameras.main.getWorldPoint(e.x,e.y),s=t.x-this.player.x,i=t.y-this.player.y;if(this.isLockedOnWall){const d=new Phaser.Math.Vector2(this.player.x-this.lastCollidingHex.x,this.player.y-this.lastCollidingHex.y).normalize();new Phaser.Math.Vector2(s,i).normalize().dot(d)>.5&&(this.isLockedOnWall=!1)}const a=new Phaser.Math.Vector2(s,i);if(a.length()<1){this.player.setVelocity(0,0);return}if(a.normalize(),!this.isLockedOnWall){const d=this.game.loop.delta/1e3,u=1-Math.exp(-this.turnEase*d);this.dir.lerp(a,u)}this.dir.normalize();const n=this.dir,o=this.playerSpeed*(this.game.loop.delta/1e3),r=this.player.x+n.x*o,h=this.player.y+n.y*o;let l=!1,c=null;const m=20,p=[{x:r,y:h},{x:r+n.x*m,y:h+n.y*m},{x:r+n.y*m,y:h-n.x*m},{x:r-n.y*m,y:h+n.x*m}];for(const d of p){const u=this.getNearestHexagon(d.x,d.y);if(u&&u.texture.key==="limit"){l=!0,c=u;break}}if(!l)this.player.setVelocity(n.x*this.playerSpeed,n.y*this.playerSpeed),this.player.setAngle(Phaser.Math.RadToDeg(Math.atan2(n.y,n.x)));else{this.isLockedOnWall=!0,this.lastCollidingHex=c;const d=new Phaser.Math.Vector2(this.player.x-c.x,this.player.y-c.y),u=this.hexagonSize.w/2+m;d.setLength(u),this.player.setPosition(c.x+d.x,c.y+d.y);const w=new Phaser.Math.Vector2(this.player.x-c.x,this.player.y-c.y).normalize(),f=new Phaser.Math.Vector2(w.y,-w.x),z=new Phaser.Math.Vector2(-w.y,w.x),we=n.dot(f),be=n.dot(z),T=we>be?f:z;this.player.setVelocity(T.x*this.playerSpeed,T.y*this.playerSpeed),this.dir.set(T.x,T.y),this.player.setAngle(Phaser.Math.RadToDeg(Math.atan2(T.y,T.x)))}}updateTrailPath(){const e=this.player.x,t=this.player.y,s=this.isOnMyHexagon(e,t);if(!s&&!this.isDrawing?this.startTrail(e,t):!s&&this.isDrawing?this.updateTrail(e,t):s&&this.isDrawing&&this.finishTrail(),this.checkSelfTrailCollision(this.player)){this.gameOver("hit_trail");return}}checkSelfTrailCollision(e,t=6,s=this.trailWidth){const i=this.trailPath.length;if(i<3)return!1;const a=i-1-t;if(a<=0)return!1;const n=s,o=n*n;for(let r=0;r<a;r++){const h=this.trailPath[r],l=this.trailPath[r+1],c=this.pointToSegmentDistance(e.x,e.y,h.x,h.y,l.x,l.y);if(c*c<=o)return!0}return!1}pointToSegmentDistance(e,t,s,i,a,n){const o=this.squaredDistance(s,i,a,n);if(o===0)return Math.sqrt(this.squaredDistance(e,t,s,i));const r=this.clampToUnit(((e-s)*(a-s)+(t-i)*(n-i))/o),h=s+r*(a-s),l=i+r*(n-i);return Math.sqrt(this.squaredDistance(e,t,h,l))}squaredDistance(e,t,s,i){const a=e-s,n=t-i;return a*a+n*n}clampToUnit(e){return e<0?0:e>1?1:e}isOnMyHexagon(e,t){const s=this.getNearestHexagon(e,t);if(!s||s.texture?.key!=="my_hexagon")return!1;const i=s.displayWidth||this.hexagonSize.w,a=s.displayHeight||this.hexagonSize.h;return this.pointInFlatTopHex(e,t,s.x,s.y,i,a,1)}pointInFlatTopHex(e,t,s,i,a,n,o=1){const r=a*o/2,h=n*o/2,l=[s-r,i,s-r/2,i-h,s+r/2,i-h,s+r,i,s+r/2,i+h,s-r/2,i+h],c=new Phaser.Geom.Polygon(l);return Phaser.Geom.Polygon.Contains(c,e,t)}startTrail(e,t){this.isDrawing=!0,this.trailPath.length=0,this.trailPath.push({x:e,y:t}),this.trailGraphics.clear(),this.trailGraphics.fillStyle(this.trailColor,1),this.trailGraphics.fillCircle(e,t,this.trailWidth/2)}updateTrail(e,t){const s=this.trailPath[this.trailPath.length-1],i=Phaser.Math.Distance.Between(s.x,s.y,e,t);if(i<this.interval)return;this.trailPath.push({x:e,y:t});const a=Math.ceil(i/(this.trailWidth*.6));for(let n=1;n<=a;n++){const o=n/a,r=Phaser.Math.Interpolation.Linear([s.x,e],o),h=Phaser.Math.Interpolation.Linear([s.y,t],o);this.trailGraphics.fillCircle(r,h,this.trailWidth/2);const l=this.getNearestHexagon(r,h);l&&l.texture?.key!=="my_hexagon"&&l.texture?.key!=="limit"&&this.drawHexBorder(l.x,l.y)}}finishTrail(){if(this.isDrawing=!1,this.trailPath.length<5){this.trailGraphics.clear(),this.trailPath.length=0;return}this.trailGraphics.clear();const e=this.trailPath.slice(),t=this.activeHexagon(e,!1);this.paintInsideAndBorder(e,t),this.trailPath.length=0,this.findInnerHoles(!0)}paintInsideAndBorder(e,t){const s=new Set,i=a=>{if(!a||a.texture?.key==="my_hexagon")return;const n=a.col!==void 0&&a.row!==void 0?`${a.col},${a.row}`:`${a.x},${a.y}`;s.has(n)||(s.add(n),this.markAsMyHexagon(a))};for(const a of t)i(a);for(const a of e){const n=this.getNearestHexagon(a.x,a.y);i(n)}}activeHexagon(e=this.trailPath,t=!0){if(!e||e.length<3||!Array.isArray(this.hexagonList))return[];const s=e.slice(),i=s[0],a=s[s.length-1];Phaser.Math.Distance.Between(i.x,i.y,a.x,a.y)>1&&s.push({x:i.x,y:i.y});const n=[];for(const p of s)n.push(p.x,p.y);const o=new Phaser.Geom.Polygon(n),r=Phaser.Geom.Rectangle.FromPoints(s.map(p=>new Phaser.Geom.Point(p.x,p.y))),h=[],l=Math.max(1,Math.min(this.hexagonSize.w,this.hexagonSize.h)*.35),c=8,m=(p,d)=>{if(Phaser.Geom.Polygon.Contains(o,p,d))return!0;for(let u=0;u<c;u++){const w=Math.PI*2*u/c,f=p+l*Math.cos(w),z=d+l*Math.sin(w);if(Phaser.Geom.Polygon.Contains(o,f,z))return!0}return!1};for(const p of this.hexagonList){const{x:d,y:u}=p;Phaser.Geom.Rectangle.Contains(r,d,u)&&m(d,u)&&h.push(p)}return t&&h.forEach(p=>this.markAsMyHexagon(p)),h}getNearestHexagon(e,t){let s=null,i=1/0;for(const a of this.hexagonList){const n=Phaser.Math.Distance.Between(e,t,a.x,a.y);n<i&&(i=n,s=a)}return s}getClosestWallToPoint(e){let t=null,s=1/0;const i=this.playerBoundsHexagon.points;for(let a=0;a<i.length;a++){const n=i[a],o=i[(a+1)%i.length],r=new Phaser.Geom.Line(n.x,n.y,o.x,o.y),h=new Phaser.Geom.Point;Phaser.Geom.Line.GetNearestPoint(r,e,h);const l=Phaser.Math.Distance.Between(e.x,e.y,h.x,h.y);l<s&&(s=l,t=r)}return t}gameOver(e="hit_trail"){this.isGameOver||(P.stop(),this.sound.play("lose"),this.isGameOver=!0,this.physics.world.pause(),this.player.setVelocity(0,0),this.isDrawing=!1,this.spawnTimer?.remove(),this.tweens.add({targets:this.player,alpha:{from:1,to:.2},yoyo:!0,duration:100,repeat:4}),this.time.delayedCall(350,()=>{this.scene.pause(),this.scene.launch("GameOverScene",{reason:e})}))}cullEnemiesOnMyHex(){if(!this.enemies)return;const e=this.enemies.getChildren();for(let t=e.length-1;t>=0;t--){const s=e[t];!s||!s.active||this.isOnMyHexagon(s.x,s.y)&&this.fadeOutAndRemoveEnemy(s)}}fadeOutAndRemoveEnemy(e){e.pendingRemoval||(e.pendingRemoval=!0,this.tweens.killTweensOf(e),e.setVelocity?.(0,0),e.body&&(e.body.enable=!1),this.tweens.add({targets:e,alpha:{from:1,to:.2},yoyo:!0,duration:120,repeat:4,onComplete:()=>{this.tweens.killTweensOf(e),e.destroy()}}))}checkEnemiesHitTrail(){if(!this.enemies||!this.isDrawing)return;const e=this.trailPath.length;if(e<2)return!1;const t=this.enemies.getChildren();if(!t||t.length===0)return!1;for(let s=0;s<t.length;s++){const i=t[s];if(!i||!i.active||i.pendingRemoval)continue;const a=this.trailWidth*.5+this.enemyRadius;for(let n=0;n<e;n+=1){const o=this.trailPath[n],r=i.x-o.x,h=i.y-o.y;if(r*r+h*h<=a*a)return this.gameOver("enemy_hit_trail"),!0}}return!1}markAsMyHexagon(e){e&&(e.texture?.key==="my_hexagon"||e.texture?.key==="limit"||(e.setTexture("my_hexagon"),e.setDepth&&e.setDepth(1),this.stage&&typeof this.stage.updateQuizMask=="function"&&this.stage.updateQuizMask()))}}const D=[`아쉬워!
할 수 있었는데!`,`아까워!
실수한 거야!`,`아,
잘하고 있었는데!`,`다시 해보자!
할 수 있어!`,`괜찮아,
다시 하면 돼!`,`다음엔
꼭 성공한다!`,`조금 어렵지만
할 수 있어!`,`침착하게
다시 해보자!`,`포기 안 해!
다시 할거야!`,`이제 알겠어!
다시 도전!`,`감 잡았어!
이번엔 성공할거야!`,`앗! 아깝다~!
다시 도전!`,`실수할 수도 있지!
다시 하자!`];class ue extends Phaser.Scene{constructor(){super("GameOverScene")}init(e){this.reason=e.reason}create(){this.centerX=this.cameras.main.width/2,this.centerY=this.cameras.main.height/2,k(this,0,.7),this.createUI(),this.createText(),this.createButton()}initBackground(){const e=this.add.graphics();e.fillStyle(0,.7),e.fillRect(0,0,this.sys.game.config.width,this.sys.game.config.height)}createUI(){const e=this.add.sprite(this.centerX,this.centerY-130,"bee_over_1");this.anims.exists("bee_fly")||this.anims.create({key:"bee_fly",frames:[...this.anims.generateFrameNumbers("bee_over_1",{start:0,end:12}),...this.anims.generateFrameNumbers("bee_over_2",{start:0,end:12}),...this.anims.generateFrameNumbers("bee_over_3",{start:0,end:12}),...this.anims.generateFrameNumbers("bee_over_4",{start:0,end:12}),...this.anims.generateFrameNumbers("bee_over_5",{start:0,end:12})],frameRate:12,repeat:-1}),e.play("bee_fly"),this.add.image(900,167,"game_over_balloon"),this.add.image(this.centerX,this.centerY+100,"game_over_text_box")}createText(){this.createResonText(),this.createBalloonText()}createButton(){const e=this.add.sprite(this.centerX,this.centerY+260,"return_button").setInteractive({useHandCursor:!0});e.on("pointerover",()=>e.setFrame(1)),e.on("pointerout",()=>e.setFrame(0)),e.on("pointerdown",()=>{this.sound.play("click"),this.chageScene()})}chageScene(){this.scene.stop("GameOverScene"),this.scene.start("StartScene")}createResonText(){this.add.image(this.centerX,this.centerY+96,`${this.reason}_text`)}createBalloonText(){const e=Math.floor(Math.random()*D.length),t=D[e];this.add.text(900,154,t,{fontSize:"32px",fontFamily:ee,color:"#000000",align:"center"}).setOrigin(.5,.5)}}const v={main:"#ee5d62",hover:"#4d8900",white:"#ffffff",black:"#000000"};class fe extends Phaser.Scene{constructor(){super("QuizScene")}init(e){this.quiz=e.quiz,this.allQuizzes=e.allQuizzes,this.canvasSize=e.canvasSize,this.medalNumber=e.medalNumber}create(){const e=document.querySelector("canvas");e.style.transition="opacity 0.2s",setTimeout(()=>{e.style.opacity="1",e.style.transition="",this.add.image(this.scale.width/2,this.scale.height/2,"quiz_bg").setScale(x).setDepth(-1)},20);for(let t=1;t<=4;t++)this.createAnimation(t);this.createAnimation("incorrect"),this.add.image(292,56,`medal_${this.medalNumber}`).setScale(.5),this.textures.exists("worldSnapshot")&&(this.snapshotImage=this.renderMaskedImage("worldSnapshot")),this.renderAnswerButtons(),this.exitButton=this.renderFeedbackButton("exit_btn",()=>this.returnToPlayScene())}createHexMaskGraphics(e,t,s){const i=this.make.graphics({x:0,y:0,add:!1}),a=e+s/2,n=t+s/2,o=s/2;i.beginPath();for(let r=0;r<6;r++){const h=Phaser.Math.DegToRad(60*r+30),l=a+o*Math.cos(h),c=n+o*Math.sin(h);r===0?i.moveTo(l,c):i.lineTo(l,c)}return i.closePath(),i.fillPath(),i}renderMaskedImage(e){const{w:t,h:s}=this.canvasSize,i=this.add.image(t/2,s/2,e).setOrigin(0,0),a=100,n=s/4,h=this.createHexMaskGraphics(108,n,482).createGeometryMask();return i.setScale(x).setPosition(a,n).setMask(h),this.add.image(136,178,"map_bg").setOrigin(0,0).setScale(x),i}renderAnswerButtons(){const e=this.quiz.answer,t=Phaser.Utils.Array.Shuffle([...this.quiz.options]),s=this.canvasSize.w/2+270,i=270;this.itemButtonGroup=this.add.group(),t.forEach((a,n)=>{const o=s,r=i+n*120,h=this.createAnswerButton(o,r,a,()=>{this.itemButtonGroup.children.iterate(l=>l.disableInteractive&&l.disableInteractive()),this.exitButton&&this.exitButton.active&&this.exitButton.destroy(),a===e?this.correct():this.incorrect()});this.itemButtonGroup.add(h)})}createAnswerButton(e,t,s,i){const a=this.createButtonImage(e,t,"word_bg",i),n=this.createButtonText(e,t-10,s);return this.applyButtonHoverEffect(a,n),a}createButtonImage(e,t,s,i){const a=this.add.image(e,t,s).setInteractive({useHandCursor:!0}).setScale(x);return a.on("pointerdown",i),a}createButtonText(e,t,s){const i=this.add.text(e,t,s,{fontSize:"44px",fontFamily:te,color:v.white,fontStyle:"bold"}).setOrigin(.5);return i.setShadow(3,3,v.main,0,!0,!0),i}applyButtonHoverEffect(e,t){e.on("pointerover",()=>{e.setTexture("word_bg_h"),t.setColor(v.hover),t.setShadow(0,0,v.black,0,!1,!1),this.setCursor("pointer")}),e.on("pointerout",()=>{e.setTexture("word_bg"),t.setColor(v.white),t.setShadow(3,3,v.main,0,!0,!0),this.setCursor("default")})}setCursor(e="default"){this.input&&this.input.setDefaultCursor&&this.input.setDefaultCursor(e)}correct(){this.handleAnswerResult(!0)}incorrect(){this.handleAnswerResult(!1)}handleAnswerResult(e){this.setCursor("default"),this.sound.play(e?"correct":"incorrect"),e&&(this.increaseMedalCount(this.medalNumber),this.showAnswerImage(this.snapshotImage)),this.showFeedback(e);const t=e?"next_btn":"main_btn";this.renderFeedbackButton(t,()=>this.goToNextQuiz())}showAnswerImage(e){const{x:t,y:s,mask:i}=e;e.destroy();const a=this.add.image(t,s,"worldSnapshotNoHexagon").setAlpha(0).setOrigin(0,0);a.setScale(x).setPosition(t,s).setMask(i),this.tweens.add({targets:a,alpha:1,duration:1e3,ease:"Linear"}),this.add.image(136,178,"map_bg").setOrigin(0,0).setScale(x)}goToNextQuiz(){this.sound.play("click"),this.scene.stop("PlayScene"),this.scene.stop("QuizScene");const e=this.allQuizzes.filter(t=>t.answer!==this.quiz.answer);e.length===0?this.scene.start("PlayScene",{quiz:this.quiz,allQuizzes:e,showMedalOnStart:!0,medalNumber:this.medalNumber}):this.scene.start("PlayScene",{allQuizzes:e,showMedalOnStart:!0,medalNumber:this.medalNumber})}returnToPlayScene(){this.scene.stop("QuizScene"),this.scene.resume("PlayScene")}renderFeedbackButton(e,t){const s=this.canvasSize.w-270,i=this.canvasSize.h-50,a=this.add.image(s,i,e).setOrigin(1,1).setInteractive({useHandCursor:!0}).setScale(x);return a.on("pointerdown",()=>t()),M(a,`${e}`),a}showFeedback(e){const t=this.medalNumber,s=e?{img:`medal_${t}_1`,ani:`medal_${t}_ani`,txt:`text_${t}`}:{img:"bee_incorrect",ani:"incorrect_ani",txt:"text_incorrect"},i=k(this).setDepth(1).setInteractive(new Phaser.Geom.Rectangle(0,0,this.canvasSize.w,this.canvasSize.h),Phaser.Geom.Rectangle.Contains),a=this.add.sprite(this.canvasSize.w/2,this.canvasSize.h/2,s.img).setOrigin(.5).setDepth(2);a.play(s.ani);const n=this.add.image(this.canvasSize.w/2,this.canvasSize.h-100,s.txt).setOrigin(.5).setDepth(2).setScale(x);let o=0;a.on("animationrepeat",()=>{o++,o===1&&this.tweens.add({targets:[a,n,i],alpha:0,duration:1e3,ease:"Linear",onComplete:()=>{a.destroy(),n.destroy(),i.destroy()}})})}createAnimation(e){const[t,s]=e==="incorrect"?["incorrect_ani","incorrect_"]:[`medal_${e}_ani`,`medal_${e}_`];if(this.anims.exists(t))return;const i=Array.from({length:5},(a,n)=>this.anims.generateFrameNumbers(`${s}${n+1}`,{start:0,end:17})).flat();this.anims.create({key:t,frames:i,frameRate:20,repeat:-1})}increaseMedalCount(e){let t=this.registry.get("myMedals")||{1:0,2:0,3:0,4:0};t[e]++,this.registry.set("myMedals",t)}}const ye={fontSize:"24px",color:"#804515",fontFamily:C},H={fontSize:"40px",color:"#11390E",fontFamily:C},L={fontSize:"40px",color:"#FFD33C",fontFamily:C,stroke:"#942D05",strokeThickness:5,padding:{x:0,y:-3}},N={default:[{text:"숨겨진 ",style:H},{text:"그림의 정체를 ",style:L},{text:"밝혀내라!",style:H}],finish:[{text:"숨겨진 ",style:H},{text:"그림의 정체를 ",style:L},{text:"모두 밝혔다!",style:H}]};class _e extends Phaser.Scene{constructor(){super("MedalScene")}init(e){this.remainingQuizzes=e.remainingQuizzes}create(){this.centerX=this.cameras.main.width/2,this.centerY=this.cameras.main.height/2,k(this,0,.7),this.createUI(),this.createButton(),this.initBgm()}initBgm(){P.isOn?P.play():P.stop()}createButton(){const e=this.remainingQuizzes?.length>0?"start_button":"reset_button";this.actionButton=this.add.image(this.centerX,640,e).setInteractive({useHandCursor:!0}),this.homeButton=this.add.image(50,50,"home_button").setInteractive({useHandCursor:!0}),E(this.homeButton),E(this.actionButton),this.homeButton.on("pointerdown",()=>{this.sound.play("click"),this.scene.start("StartScene")}),this.actionButton.on("pointerdown",()=>{this.sound.play("click"),this.changeScene()}),this.createBgmButton()}changeScene(){this.remainingQuizzes?.length>0?(this.scene.stop("MedalScene"),this.scene.resume("PlayScene")):(this.scene.stop("PlayScene"),this.scene.stop("MedalScene"),this.scene.start("StartScene"))}createUI(){this.add.image(this.centerX,this.centerY-30,"medal_bg"),this.createResultText(),this.createMedalBox(),this.createAnimation()}createMedalBox(){const e=this.registry.get("myMedals")||{1:0,2:0,3:0,4:0};[{x:this.centerX-265,y:388,medalId:1},{x:this.centerX-84,y:388,medalId:2},{x:this.centerX+97,y:388,medalId:3},{x:this.centerX+277,y:388,medalId:4}].forEach(s=>{const{key:i,x:a,y:n,medalId:o}=s;this.add.text(s.x,n+70,`${e[o]}`,ye).setOrigin(.5)})}createResultText(){const e=this.remainingQuizzes?.length>0?N.default:N.finish,t=this.add.container(0,0);let s=0;for(const a of e){const n=this.add.text(0,0,a.text,a.style);n.setX(s),s+=n.width,t.add(n)}const i=t.getBounds();t.setPosition(this.centerX-i.width/2,this.centerY+130)}createAnimation(){const e=this.add.sprite(this.centerX,this.centerY-100,"bee_medal");this.anims.exists("bee_medal_fly")||this.anims.create({key:"bee_medal_fly",frames:this.anims.generateFrameNumbers("bee_medal",{start:0,end:49}),frameRate:10,repeat:-1}),e.play("bee_medal_fly")}createBgmButton(){this.bgmButton=this.add.image(1243,686,"volume_button").setInteractive({useHandCursor:!0}).setScrollFactor(0),this.updateBgmButtonTexture(!P.isOn),E(this.bgmButton),this.bgmButton.on("pointerdown",()=>{P.toggle(),this.updateBgmButtonTexture(!P.isOn),this.sound.play("click")})}updateBgmButtonTexture(e){this.bgmButton.setTexture(e?"mute_button":"volume_button")}}const xe={type:Phaser.WEBGL,width:1280,height:720,parent:"gameContainer",backgroundColor:"0xc9effa",scene:[W,F,Q,se,pe,ue,fe,_e],physics:{default:"arcade",arcade:{debug:!1}},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH}};new Phaser.Game(xe)})();
