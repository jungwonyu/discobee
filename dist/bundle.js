(function(){"use strict";class V extends Phaser.Scene{constructor(){super("Boot")}preload(){this.load.spritesheet("loading","assets/img/start/ice_spritesheet.png",{frameWidth:105,frameHeight:128}),this.load.image("logo","assets/img/start/icecandy_logo.png")}create(){const{width:t,height:e}=this.scale,s=this.add.rectangle(0,0,t,e,13234170).setOrigin(0,0),i=this.add.image(t/2,e/2,"logo").setAlpha(0).setScale(.7);i.setY(i.y+100),this.tweens.add({targets:i,alpha:1,y:"-=120",duration:150,ease:"ease-in-out",repeat:0,onComplete:()=>{this.tweens.add({targets:i,alpha:1,y:"+=20",duration:100,ease:"ease-in-out",repeat:0})}}),this.time.delayedCall(1200,()=>{this.tweens.add({targets:[i,s],alpha:0,duration:200,ease:"ease-in-out",repeat:0})}),this.time.delayedCall(1500,()=>this.scene.start("Preloader"))}}class X{constructor(){this.bgm=null,this.isOn=!0}init(t,e,s){this.bgm||(this.bgm=t.sound.add(e,{...s}))}play(){this.bgm.isPlaying||this.bgm.play()}toggle(){this.bgm&&(this.isOn?(this.bgm.pause(),this.isOn=!1):(this.bgm.isPaused?this.bgm.resume():this.bgm.play(),this.isOn=!0))}pause(){this.bgm?.isPlaying&&this.bgm.pause()}stop(){this.bgm.stop()}resume(){this.bgm&&!this.bgm.isPlaying&&this.bgm.resume()}}const z=new X;class $ extends Phaser.Scene{constructor(){super("Preloader")}init(){this.cameras.main.setBackgroundColor(13234170);const t=9751772,e={width:500,height:30},s={x:this.scale.width/2-e.width/2,y:this.scale.height/2-e.height/2},i=e.height/2,a=8,n={width:e.width+a,height:e.height+a},h=i+a,r={x:s.x-a/2,y:s.y-a/2},o=this.add.graphics({fillStyle:{color:16777215},lineStyle:{width:3,color:t}});o.fillRoundedRect(r.x,r.y,n.width,n.height,h),o.strokeRoundedRect(r.x,r.y,n.width,n.height,h);const l=this.add.graphics({fillStyle:{color:t}});l.fillRoundedRect(s.x,s.y,e.height,e.height,i),this.anims.create({key:"loading",frames:this.anims.generateFrameNumbers("loading",{start:1,end:4}),frameRate:12,repeat:-1});const c=this.add.sprite(0,0,"loading").play("loading");c.setScale(.5),c.y=s.y+e.height/2-c.height/2+14,this.load.on("progress",g=>{const u=Math.max(e.height,e.width*g);l.clear(),l.fillRoundedRect(s.x,s.y,u,e.height,i),c.x=s.x+u-e.height/2})}preload(){this.load.font("Cafe24Surround","assets/font/Cafe24Ssurround-v2.0.ttf"),this.load.font("TMoneyDungunbaram","assets/font/TMONEYROUNDWINDEXTRABOLD.TTF"),this.load.font("Eommakkaturi","assets/font/Katuri.woff"),this.load.font("MaplestoryBold","assets/font/MaplestoryBold.ttf"),this.load.audio("bgm_audio","./assets/mp3/bgm.mp3"),this.load.audio("lose","./assets/mp3/lose.mp3"),this.load.audio("click","./assets/mp3/click.mp3"),this.load.image("bg","assets/img/start/start_bg.png"),this.load.image("start_title","assets/img/start/start_title.png"),this.load.image("start_char","assets/img/start/start_char.png"),this.load.image("start_btn","assets/img/start/start_btn.png"),this.load.image("start_btn_h","assets/img/start/start_btn_h.png"),this.load.image("how_btn","assets/img/start/how_btn.png"),this.load.image("how_btn_h","assets/img/start/how_btn_h.png"),this.load.image("help_next_btn","assets/img/help/help_next_btn.png"),this.load.image("help_next_btn_h","assets/img/help/help_next_btn_h.png"),this.load.image("help_prev_btn","assets/img/help/help_prev_btn.png"),this.load.image("help_prev_btn_h","assets/img/help/help_prev_btn_h.png"),this.load.image("close_btn","assets/img/help/close_btn.png"),this.load.image("close_btn_h","assets/img/help/close_btn_h.png"),this.load.image("help_1","assets/img/help/help_1.png"),this.load.image("help_2","assets/img/help/help_2.png"),this.load.image("help_3","assets/img/help/help_3.png"),this.load.image("help_4","assets/img/help/help_4.png"),this.load.image("help_text_1","assets/img/help/help_text_1.png"),this.load.image("help_text_2","assets/img/help/help_text_2.png"),this.load.image("help_text_3","assets/img/help/help_text_3.png"),this.load.image("help_text_4","assets/img/help/help_text_4.png"),this.load.image("hexagon","assets/img/play/hexagon.png"),this.load.image("limit","assets/img/play/limit.png"),this.load.image("my_hexagon","assets/img/play/hexagon_h.png"),this.load.image("player","assets/img/play/player.png"),this.load.image("player_speed","assets/img/play/player_speed.png"),this.load.image("player_invincible","assets/img/play/player_invincible.png"),this.load.image("enemy","assets/img/play/enemy.png"),this.load.image("enemy_freeze","assets/img/play/enemy_freeze.png"),this.load.image("item_freeze","assets/img/play/freeze.png"),this.load.image("item_speed","assets/img/play/speed.png"),this.load.image("item_invincible","assets/img/play/invincible.png"),this.load.spritesheet("buster_effect","assets/img/play/buster_effect.png",{frameWidth:200,frameHeight:200}),this.load.spritesheet("shield_effect","assets/img/play/shield_effect.png",{frameWidth:200,frameHeight:200}),this.load.image("game_over_bee","assets/img/over/over_bee.png"),this.load.image("game_over_balloon","assets/img/over/over_ballon.png"),this.load.image("game_over_text_box","assets/img/over/over_text_box.png"),this.load.image("medal_bg","assets/img/medal/medal_bg.png"),this.load.spritesheet("return_button","assets/img/button/return_button.png",{frameWidth:215.5,frameHeight:103}),this.load.spritesheet("home_button","assets/img/button/home_button.png",{frameWidth:72,frameHeight:74}),this.load.spritesheet("reset_button","assets/img/button/reset_button.png",{frameWidth:218,frameHeight:105}),this.load.spritesheet("volume_button","assets/img/button/volume_button.png",{frameWidth:72,frameHeight:73}),this.load.spritesheet("mute_button","assets/img/button/mute_button.png",{frameWidth:72,frameHeight:73}),this.load.spritesheet("start_button","assets/img/button/start_button.png",{frameWidth:231,frameHeight:106}),this.load.image("quiz_start","assets/img/map/quiz_start.png"),this.load.image("quiz_start_h","assets/img/map/quiz_start_h.png"),this.load.image("mini_medal_1","assets/img/map/mini_medal_1.png"),this.load.image("mini_medal_2","assets/img/map/mini_medal_2.png"),this.load.image("mini_medal_3","assets/img/map/mini_medal_3.png"),this.load.image("mini_medal_4","assets/img/map/mini_medal_4.png"),this.load.image("map_bg","assets/img/quiz/map_bg.png"),this.load.image("quiz_bg","assets/img/quiz/quiz_bg.png"),this.load.image("word_bg","assets/img/quiz/word_bg.png"),this.load.image("word_bg_h","assets/img/quiz/word_bg_h.png"),this.load.image("text_incorrect","assets/img/quiz/text_incorrect.png"),this.load.image("text_1","assets/img/quiz/text_1.png"),this.load.image("text_2","assets/img/quiz/text_2.png"),this.load.image("text_3","assets/img/quiz/text_3.png"),this.load.image("text_4","assets/img/quiz/text_4.png"),this.load.spritesheet("incorrect_1","assets/img/quiz/incorrect_1.png",{frameWidth:355.2,frameHeight:448}),this.load.spritesheet("incorrect_2","assets/img/quiz/incorrect_2.png",{frameWidth:355.2,frameHeight:448}),this.load.spritesheet("incorrect_3","assets/img/quiz/incorrect_3.png",{frameWidth:355.2,frameHeight:448}),this.load.spritesheet("incorrect_4","assets/img/quiz/incorrect_4.png",{frameWidth:355.2,frameHeight:448}),this.load.spritesheet("incorrect_5","assets/img/quiz/incorrect_5.png",{frameWidth:355.2,frameHeight:448}),this.load.image("medal_1","assets/img/quiz/medal_1.png"),this.load.spritesheet("medal_1_1","assets/img/quiz/medal_1_1.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_1_2","assets/img/quiz/medal_1_2.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_1_3","assets/img/quiz/medal_1_3.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_1_4","assets/img/quiz/medal_1_4.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_1_5","assets/img/quiz/medal_1_5.png",{frameWidth:506.5,frameHeight:592}),this.load.image("medal_2","assets/img/quiz/medal_2.png"),this.load.spritesheet("medal_2_1","assets/img/quiz/medal_2_1.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_2_2","assets/img/quiz/medal_2_2.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_2_3","assets/img/quiz/medal_2_3.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_2_4","assets/img/quiz/medal_2_4.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_2_5","assets/img/quiz/medal_2_5.png",{frameWidth:506.5,frameHeight:592}),this.load.image("medal_3","assets/img/quiz/medal_3.png"),this.load.spritesheet("medal_3_1","assets/img/quiz/medal_3_1.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_3_2","assets/img/quiz/medal_3_2.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_3_3","assets/img/quiz/medal_3_3.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_3_4","assets/img/quiz/medal_3_4.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_3_5","assets/img/quiz/medal_3_5.png",{frameWidth:506.5,frameHeight:592}),this.load.image("medal_4","assets/img/quiz/medal_4.png"),this.load.spritesheet("medal_4_1","assets/img/quiz/medal_4_1.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_4_2","assets/img/quiz/medal_4_2.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_4_3","assets/img/quiz/medal_4_3.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_4_4","assets/img/quiz/medal_4_4.png",{frameWidth:506.5,frameHeight:592}),this.load.spritesheet("medal_4_5","assets/img/quiz/medal_4_5.png",{frameWidth:506.5,frameHeight:592}),this.load.image("main_btn","assets/img/quiz/mainPage_btn.png"),this.load.image("main_btn_h","assets/img/quiz/mainPage_btn_h.png"),this.load.image("next_btn","assets/img/quiz/next_btn.png"),this.load.image("next_btn_h","assets/img/quiz/next_btn_h.png"),this.load.image("exit_btn","assets/img/quiz/exit_btn.png"),this.load.image("exit_btn_h","assets/img/quiz/exit_btn_h.png"),this.load.audio("correct","assets/mp3/correct.mp3"),this.load.audio("incorrect","assets/mp3/incorrect.mp3"),this.load.image("minimap_bg","assets/img/map/minimap_bg.png")}create(){this.initBgm(),this.time.delayedCall(500,()=>{this.scene.start("StartScene")})}initBgm(){z.init(this,"bgm_audio",{loop:!0,volume:.05})}}const E=(m,t=0,e=.7)=>{const{width:s,height:i}=m.sys.game.config;return m.add.rectangle(0,0,s,i,t,e).setOrigin(0,0).setDepth(0)},T=(m,t,e)=>{const s=`${t}_h`,i=m.scene;!i.textures.exists(t)||!i.textures.exists(s)||(m.on("pointerover",()=>m.setTexture(s)),m.on("pointerout",()=>m.setTexture(t)))},I=m=>{m.on("pointerover",()=>m.setFrame(1)),m.on("pointerout",()=>m.setFrame(0))},R=m=>m<=5?1:m<=15?2:m<=30?3:4,x={TITLE:{x:640,y:200,scale:.6},CHAR:{x:600,y:450,scale:.6},START_BTN:{x:640,y:630,scale:.6667},HOW_BTN:{x:1180,y:100,scale:.6667}};class U extends Phaser.Scene{constructor(){super("StartScene")}create(){this.initScene(),this.createBackground(),this.createUI(),this.createButtons()}initScene(){this.registry.set("myMedals",{1:0,2:0,3:0,4:0}),["PlayScene","QuizScene","GameOverScene","MedalScene"].forEach(t=>this.scene.stop(t))}createBackground(){const{width:t,height:e}=this.sys.game.config,s=this.add.image(0,0,"bg").setOrigin(0),i=Math.max(t/s.width,e/s.height);s.setScale(i).setScrollFactor(0)}createUI(){const t=this.add.image(x.TITLE.x,x.TITLE.y-50,"start_title").setScale(x.TITLE.scale),e=this.add.image(x.CHAR.x+200,x.CHAR.y-50,"start_char").setScale(x.CHAR.scale*.5);this.tweens.add({targets:t,y:x.TITLE.y,ease:"Sine.easeInOut",duration:800,yoyo:!1}),this.tweens.add({targets:e,scale:x.CHAR.scale,x:x.CHAR.x,y:x.CHAR.y,ease:"Sine.easeInOut",duration:800,yoyo:!1})}createButtons(){this.createStartButton(),this.createHowToPlayButton()}createStartButton(){const t=this.add.sprite(x.START_BTN.x,x.START_BTN.y,"start_btn",0).setInteractive({useHandCursor:!0}).setScale(x.START_BTN.scale);t.on("pointerdown",()=>{this.sound.play("click"),this.cameras.main.fadeOut(200,255,255,255),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("PlayScene",{showMedalOnStart:!0})})}),T(t,"start_btn")}createHowToPlayButton(){const t=this.add.sprite(x.HOW_BTN.x,x.HOW_BTN.y,"how_btn",0).setInteractive({useHandCursor:!0}).setScale(x.HOW_BTN.scale);t.on("pointerdown",()=>this.scene.launch("HelpScene")),T(t,"how_btn")}}const y={width:64,height:55},D={width:1280,height:720},L={col:62,row:53},b={width:(L.col-1)*(y.width*.75)+y.width,height:(L.row-1)*y.height+y.height},_=.6667,Z=150,K=5,j=10,J=10,tt="0x5092FF",et=30,st=60,it=100,at=10,q="Cafe24Surround",nt="TMoneyDungunbaram",rt="Eommakkaturi",ot="MaplestoryBold",N={DOT_INACTIVE:9206321,DOT_ACTIVE:16767813};class ht extends Phaser.Scene{constructor(){super("HelpScene")}create(){this.initScene(),this.createUI(),this.createPages(),this.showPage(0)}initScene(){const{width:t,height:e}=this.sys.game.config;this.centerX=t/2,this.centerY=e/2,this.pages=[],this.pageIndicators=[],this.totalPages=4,this.currentPage=0}createUI(){E(this).setInteractive(),this.createNavigation(),this.createPageIndicator(),this.createCloseButton()}createPages(){for(let t=0;t<this.totalPages;t++){const e=this.add.container(0,0).setVisible(!1),s=this.add.image(this.centerX,this.centerY-50,`help_${t+1}`).setScale(_),i=this.add.image(this.centerX,this.sys.game.config.height-120,`help_text_${t+1}`).setScale(_);e.add([s,i]),this.pages.push(e)}}createCloseButton(){const t=this.add.image(0,0,"close_btn").setScale(_).setPosition(this.sys.game.config.width-50,50).setInteractive({useHandCursor:!0});T(t,"close_btn"),t.on("pointerdown",()=>this.scene.stop())}createNavigation(){const t=this.add.image(0,0,"help_prev_btn").setScale(_).setPosition(50,this.centerY).setInteractive({useHandCursor:!0});T(t,"help_prev_btn");const e=this.add.image(0,0,"help_next_btn").setScale(_).setPosition(this.sys.game.config.width-50,this.centerY).setInteractive({useHandCursor:!0});T(e,"help_next_btn"),t.on("pointerdown",()=>this.prevPage()),e.on("pointerdown",()=>this.nextPage())}createPageIndicator(){this.pageIndicators=[];for(let t=0;t<this.totalPages;t++){const e=this.centerX+(t-(this.totalPages-1)/2)*30,s=this.sys.game.config.height-30,i=this.add.circle(e,s,8,N.DOT_INACTIVE).setScale(_).setInteractive({useHandCursor:!0}),a=this.add.graphics().setPosition(e,s).fillStyle(N.DOT_ACTIVE,1).fillRoundedRect(-20,-8,40,16,8).setScale(_).setVisible(!1).setDepth(2);this.pageIndicators.push({circle:i,graphics:a}),i.on("pointerdown",()=>this.showPage(t))}}updatePageIndicators(t){this.pageIndicators.forEach((e,s)=>{const i=s===t;e.circle.setVisible(!i),e.graphics.setVisible(i)})}showPage(t){this.pages.forEach((e,s)=>e.setVisible(s===t)),this.currentPage=t,this.updatePageIndicators(t)}nextPage(){const t=(this.currentPage+1)%this.totalPages;this.showPage(t)}prevPage(){const t=(this.currentPage-1+this.totalPages)%this.totalPages;this.showPage(t)}}const lt=[{answer:"banana",quizImage:"assets/img/play/world/banana.png",fullImage:"assets/img/play/world/banana_full.png",options:["bread","banana","potato"]},{answer:"diamond",quizImage:"assets/img/play/world/diamond.png",fullImage:"assets/img/play/world/diamond_full.png",options:["ice","diamond","mountain"]},{answer:"duck",quizImage:"assets/img/play/world/duck.png",fullImage:"assets/img/play/world/duck_full.png",options:["duck","snake","rabbit"]},{answer:"fan",quizImage:"assets/img/play/world/fan.png",fullImage:"assets/img/play/world/fan_full.png",options:["fan","net","basket"]},{answer:"sandwich",quizImage:"assets/img/play/world/sandwich.png",fullImage:"assets/img/play/world/sandwich_full.png",options:["cake","cutlet","sandwich"]},{answer:"scissors",quizImage:"assets/img/play/world/scissors.png",fullImage:"assets/img/play/world/scissors_full.png",options:["clock","scissors","skate shoes"]},{answer:"umbrella",quizImage:"assets/img/play/world/umbrella.png",fullImage:"assets/img/play/world/umbrella_full.png",options:["glass","spider","umbrella"]},{answer:"pencil",quizImage:"assets/img/play/world/pencil.png",fullImage:"assets/img/play/world/pencil_full.png",options:["wood","cookie","pencil"]},{answer:"ant",quizImage:"assets/img/play/world/ant.png",fullImage:"assets/img/play/world/ant_full.png",options:["scorpion","ant","butterfly"]},{answer:"book",quizImage:"assets/img/play/world/book.png",fullImage:"assets/img/play/world/book_full.png",options:["sun","gold","book"]}];class ct{constructor({scene:t,properties:e}){this.scene=t,this.hexagonList=[],this.hexagonMap=new Map,this.answer=e.answer,this.tileWidth=y.width*.75,this.tileHeight=y.height,this.radiusByWidth=b.width/this.tileWidth/2,this.radiusByHeight=b.height/this.tileHeight/2,this.mapRadius=Math.floor(Math.min(this.radiusByWidth,this.radiusByHeight))-1,this.init()}init(){this.initQuizBg(),this.createHexagon(),this.createHexMask(),this.createQuizMask()}createQuizMask(){if(this.quizMaskGraphics=this.scene.make.graphics({add:!1}),this.updateQuizMask(),this.quizBg){const t=new Phaser.Display.Masks.GeometryMask(this.scene,this.quizMaskGraphics);this.quizBg.setMask(t)}}updateQuizMask(){if(this.quizMaskGraphics){this.quizMaskGraphics.clear();for(const t of this.hexagonList){if(t.texture&&t.texture.key!=="my_hexagon")continue;const e=t.x,s=t.y,i=this.getHexPoints(e,s,y.width,y.height);this.quizMaskGraphics.fillStyle(16777215,1),this.quizMaskGraphics.beginPath(),this.quizMaskGraphics.moveTo(i[0],i[1]);for(let a=2;a<i.length;a+=2)this.quizMaskGraphics.lineTo(i[a],i[a+1]);this.quizMaskGraphics.closePath(),this.quizMaskGraphics.fillPath()}}}initQuizBg(){this.quizBg=this.scene.add.image(b.width/2,b.height/2,this.answer).setDepth(0).setVisible(!0),this.bgDim=this.scene.add.graphics(),this.bgDim.fillStyle(0,.45).fillRect(0,0,b.width,b.height).setDepth(-10)}createHexMask(){const t=this.scene.make.graphics({add:!1});this.hexagonList.forEach(s=>{const{x:i,y:a,texture:n}=s;if(n.key==="limit")return;const h=this.getHexPoints(i,a,y.width,y.height),r=new Phaser.Geom.Polygon(h);t.fillPoints(r.points,!0)});const e=new Phaser.Display.Masks.GeometryMask(this.scene,t);this.bgDim.setMask(e)}createHexagon(){const t=Math.ceil((b.width+y.width)/this.tileWidth),e=Math.ceil((b.height+y.height/2)/y.height),s={col:Math.floor(t/2),row:Math.floor(e/2)},i=this.offsetToCube(s.col,s.row),a=(t-1)*this.tileWidth+y.width,n=(e-1)*y.height+y.height,h=b.width/2-a/2,r=b.height/2-n/2-25;for(let o=-1;o<t;o++)for(let l=-1;l<e;l++){const c=this.offsetToCube(o,l),g=this.getCubeDistance(i,c);if(g>this.mapRadius+1)continue;const u=o%2!==0,d=o*this.tileWidth+y.width/2+h,p=l*y.height+(u?y.height/2:0)+y.height/2+r,w=g>this.mapRadius?"limit":"hexagon",f=this.scene.add.image(d,p,w).setOrigin(.5);w==="hexagon"&&f.setAlpha(1),f.col=o,f.row=l,this.hexagonList.push(f),this.hexagonMap.set(`${o},${l}`,f)}}createRandomStartTerritory(){const t=this.hexagonList.filter(s=>this.getAroundTiles(s.col).every(i=>{const a=this.hexagonMap.get(`${s.col+i[0]},${s.row+i[1]}`);return a&&a.texture.key!=="limit"})),e=Phaser.Utils.Array.GetRandom(t);return e?([e,...this.getAroundTiles(e.col).map(s=>this.hexagonMap.get(`${e.col+s[0]},${e.row+s[1]}`)).filter(Boolean)].forEach(s=>s.setTexture("my_hexagon")),this.updateQuizMask&&this.updateQuizMask(),e):null}getAroundTiles(t){return t%2!==0?[[0,-1],[0,1],[-1,0],[1,0],[-1,1],[1,1]]:[[0,-1],[0,1],[-1,-1],[1,-1],[-1,0],[1,0]]}offsetToCube(t,e){const s=t,i=e-(t-(t&1))/2,a=-s-i;return{x:s,y:a,z:i}}getCubeDistance(t,e){return(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z))/2}getHexPoints(t,e,s,i){return[t-s/2,e,t-s/4,e-i/2,t+s/4,e-i/2,t+s/2,e,t+s/4,e+i/2,t-s/4,e+i/2]}}class A{static getFittedSize(t,e,s,i){const a=t/e;let n=s,h=n/a;return h>i&&(h=i,n=h*a),{w:n,h}}constructor(t){this.scene=t,this.minimapCam=null,this.quizButton=null,this.medalIcon=null,this.createMinimap()}createMinimap(){const t=this.scene,e=10,s=250,i=250,a=188,n=t.world.w,h=t.world.h,{w:r,h:o}=A.getFittedSize(n,h,s,i),l=t.scale.width-r-e,c=e,g=r/n,u=t.add.image(l+14,a,"minimap_bg").setOrigin(0).setScrollFactor(0).setScale(.65).setDepth(998);if(this.minimapCam=t.cameras.add(l,c,r,o).setBounds(0,0,n,h).setZoom(g).setName("minimap"),this.createQuizButtonAndMedal(),t.hexagonList&&Array.isArray(t.hexagonList)){const d=t.hexagonList.filter(p=>p.texture&&p.texture.key==="hexagon");this.minimapCam.ignore([...d,u,this.quizButton,this.medalIcon])}t.medalIcon=this.medalIcon}createQuizButtonAndMedal(){const e=this.scene,s=1182,i=298;this.quizButton=e.add.image(s,i,"quiz_start").setScale(.6667).setScrollFactor(0).setDepth(9999).setInteractive({useHandCursor:!0}),T(this.quizButton,"quiz_start"),this.quizButton.on("pointerdown",this.snapshot,this);const n=`mini_medal_${R(this.hexagonPercent())}`,h=1082,r=i;this.medalIcon=e.add.image(h,r,n).setScale(.6667).setScrollFactor(0).setDepth(9999)}snapshot(){const t=this.scene,e=t.cameras.main;t.scene.pause(),document.querySelector("canvas").style.opacity="0";const s=t.itemManager?.items||t.items,i=t.activeEffects||[],a=[t.player,t.enemies,this.minimapCam,this.quizButton,s,t.trailGraphics,...i],n=t.stage.hexagonList.filter(d=>d.visible!==!1),h=[t.stage.bgDim];[...a,...n,...h].forEach(d=>d&&d.setVisible(!1));let r=t.stage&&t.stage.quizBg,o=null;r&&r.mask&&(o=r.mask,r.setMask(null));const l=e.zoom,c=t.canvasSize.w/t.world.w,g=t.canvasSize.h/t.world.h,u=Math.min(c,g);e.stopFollow().setZoom(u).setScroll(0,0),t.game.renderer.snapshot(d=>{r&&o&&r.setMask(o),t.stage.hexagonList.filter(f=>f.texture.key==="hexagon").forEach(f=>f.setVisible(!0));const w=t.stage.hexagonList.filter(f=>f.visible!==!1&&f.texture.key!=="hexagon");[...a,...w,...h].forEach(f=>f&&f.setVisible(!1)),setTimeout(()=>{t.game.renderer.snapshot(f=>{[...a,...n,...h].forEach(P=>P&&P.setVisible(!0)),e.setZoom(l).startFollow(t.player),t.textures.exists("worldSnapshot")&&t.textures.remove("worldSnapshot"),t.textures.exists("worldSnapshotNoHexagon")&&t.textures.remove("worldSnapshotNoHexagon"),t.textures.addImage("worldSnapshot",f),t.textures.addImage("worldSnapshotNoHexagon",d),t.scene.launch("QuizScene",{quiz:t.quiz,allQuizzes:t.allQuizzes,canvasSize:t.canvasSize,medalNumber:R(this.hexagonPercent())})})},0)})}hexagonPercent(){const t=this.scene.hexagonList,e=t.filter(i=>i.texture.key!=="limit").length,s=t.filter(i=>i.texture.key==="my_hexagon").length;return e===0?0:Math.floor(s/e*100)}updateMedal(){if(this.medalIcon){const e=`mini_medal_${R(this.hexagonPercent())}`;this.medalIcon.setTexture(e)}}}const dt=60,gt=200,mt=50,G=12,ut=200,pt=200,ft=[160,260],yt=[120,220];function S(m,t,e){const s=m.getNearestHexagon(t,e);return!s||s.texture.key==="limit"||m.isOnMyHexagon(t,e)?!1:!m.hexagonList.filter(a=>Phaser.Math.Distance.Between(a.x,a.y,s.x,s.y)<dt&&a!==s).some(a=>a.texture?.key==="limit")}class xt{constructor(t){this.scene=t,this.config={enemyGroup:t.enemies,enemyRadius:t.enemyRadius,enemyRange:t.enemyRange,enemySpeed:t.enemySpeed,canvasSize:t.canvasSize,world:t.world,player:()=>t.player,hexagonList:t.hexagonList},this.bounds={minX:t.canvasSize.w/2,minY:t.canvasSize.h/2,maxX:t.world.w,maxY:t.world.h}}pickPattern(){return Phaser.Math.RND.pick(["LR","APPROACH","UD","APPROACH","CIRCLE","RECT","APPROACH"])}spawnEnemySimple(t=this.pickPattern()){const e=this.config,s=this.bounds;if(!e.enemyGroup)return;let i,a,n=0,h=!1;for(;!h&&n<mt;){i=Phaser.Math.Between(s.minX,s.maxX),a=Phaser.Math.Between(s.minY,s.maxY);const r=Phaser.Math.Distance.Between(i,a,e.player().x,e.player().y);S(this.scene,i,a)&&r>gt&&(h=!0),n++}if(h){const r=e.enemyGroup.create(i,a,"enemy");return r.setSize(e.enemyRadius*2,e.enemyRadius*2),r.setScale(.7),r.setDepth(1),this.startPattern(r,t),r}return null}startPattern(t,e){const s=this.bounds;if(!(!t||!t.active||t.pendingRemoval))switch(e){case"LR":return this.startLR(t,s.minX,s.maxX);case"UD":return this.startUD(t,s.minY,s.maxY);case"CIRCLE":return this.startCircle(t,s.minX,s.maxX,s.minY,s.maxY);case"APPROACH":return this.startApproach(t,s.minX,s.maxX,s.minY,s.maxY);default:return this.startRect(t,s.minX,s.maxX,s.minY,s.maxY)}}nextPattern(t){!t||!t.active||t.pendingRemoval||this.startPattern(t,this.pickPattern())}go(t,e,s){const i=this.config;if(!t||!t.active||t.pendingRemoval)return;const a=Phaser.Math.Distance.Between(t.x,t.y,e.x,e.y),n=Math.max(50,a/(i.enemySpeed||90)*1e3);this.scene.tweens.killTweensOf(t),this.scene.tweens.add({targets:t,x:e.x,y:e.y,duration:n,ease:"Linear",onComplete:s})}chain(t,e,s){let i=0;const a=()=>{if(!t||!t.active||t.pendingRemoval)return;if(i>=e.length){s&&s();return}const n=e[i++];this.go(t,n,a)};a()}startLR(t,e,s){const i=this.config,a=Math.floor((i.enemyRange||ut)/2),n=Phaser.Math.Clamp(t.x-a,e,s),h=Phaser.Math.Clamp(t.x+a,e,s),r=[];if(S(this.scene,n,t.y)&&r.push({x:n,y:t.y}),S(this.scene,h,t.y)&&r.push({x:h,y:t.y}),r.length<2)return this.nextPattern(t);const l=Math.abs(t.x-n)<=Math.abs(t.x-h)?r:r.slice().reverse();this.chain(t,l,()=>this.nextPattern(t))}startUD(t,e,s){const i=this.config,a=Math.floor((i.enemyRange||pt)/2),n=Phaser.Math.Clamp(t.y-a,e,s),h=Phaser.Math.Clamp(t.y+a,e,s),r=[];if(S(this.scene,t.x,n)&&r.push({x:t.x,y:n}),S(this.scene,t.x,h)&&r.push({x:t.x,y:h}),r.length<2)return this.nextPattern(t);const l=Math.abs(t.y-n)<=Math.abs(t.y-h)?r:r.slice().reverse();this.chain(t,l,()=>this.nextPattern(t))}startCircle(t,e,s,i,a){const n=Phaser.Math.Between(80,140),h=Math.min(t.x-e,s-t.x,t.y-i,a-t.y),r=Math.max(20,Math.min(n,h)),o=t.x,l=t.y,c=[];for(let g=1;g<=G;g++){const u=2*Math.PI*g/G,d=o+r*Math.cos(u),p=l+r*Math.sin(u);S(this.scene,d,p)&&c.push({x:d,y:p})}if(c.length<3)return this.nextPattern(t);this.chain(t,c,()=>this.nextPattern(t))}startRect(t,e,s,i,a){this.config;const n=Math.floor(Phaser.Math.Between(...ft)/2),h=Math.floor(Phaser.Math.Between(...yt)/2),r=Phaser.Math.Clamp(t.x-n,e,s),o=Phaser.Math.Clamp(t.x+n,e,s),l=Phaser.Math.Clamp(t.y-h,i,a),c=Phaser.Math.Clamp(t.y+h,i,a),g=[];if(S(this.scene,r,l)&&g.push({x:r,y:l}),S(this.scene,o,l)&&g.push({x:o,y:l}),S(this.scene,o,c)&&g.push({x:o,y:c}),S(this.scene,r,c)&&g.push({x:r,y:c}),g.length<3)return this.nextPattern(t);this.chain(t,g,()=>this.nextPattern(t))}startApproach(t,e,s,i,a){const n=this.config;if(!t||!t.active||t.pendingRemoval)return;const h=n.player();if(!h)return this.nextPattern(t);const r=h.x-t.x,o=h.y-t.y,l=Math.hypot(r,o);if(l<1)return this.nextPattern(t);const c=Math.min(n.enemyRange||100,l),g=r/l,u=o/l;let d=t.x+g*c,p=t.y+u*c;d=Phaser.Math.Clamp(d,e,s),p=Phaser.Math.Clamp(p,i,a),this.go(t,{x:d,y:p},()=>this.nextPattern(t))}}class _t{constructor(t){this.scene=t,this.items=t.physics.add.group(),this.activeTimers=[],this.itemTypes=["freeze","speed","invincible"]}start(){this.itemTimer=this.scene.time.addEvent({delay:7e3,callback:()=>this.spawnItem(),callbackScope:this,loop:!0}),this.activeTimers.push(this.itemTimer)}shutdown(){this.activeTimers.forEach(t=>t&&t.remove()),this.activeTimers=[],this.items.getChildren().forEach(t=>t&&t.destroy())}spawnItem(){const t=this.scene,e=Phaser.Math.RND.pick(this.itemTypes),s=this.items.getChildren?this.items.getChildren():[],i=t.hexagonList;let a=null;for(let h=0;h<30;h++){const r=Phaser.Math.RND.pick(i);if(r.texture?.key==="limit"||t.isOnMyHexagon(r.x,r.y))continue;if(!s.some(l=>{const c=(l.x??0)-r.x,g=(l.y??0)-(r.y-10);return Math.sqrt(c*c+g*g)<30})){a=r;break}}if(!a)return;const n=this.items.create(a.x,a.y-10,`item_${e}`);n.setScale(.53),n.itemType=e,t.time.delayedCall(3e4,()=>{n.active&&n.destroy()},[],this)}eatItem(t,e){this.applyItemEffect(e),e.destroy()}applyItemEffect(t){switch(t.itemType){case"freeze":this.freezeEnemies(1e4);break;case"speed":this.boostPlayerSpeed(1e4,100);break;case"invincible":this.makePlayerInvincible(1e4);break}}freezeEnemies(t){const e=this.scene;if(e.enemyFrozen){e.time.delayedCall(t,()=>this.unfreezeEnemies(),[],this);return}e.enemyFrozen=!0,e.spawnTimer&&(e.spawnTimer.paused=!0);const s=e.enemies.getChildren();for(const i of s)e.tweens.killTweensOf(i),i.setVelocity(0),i.setTexture("enemy_freeze"),e.frozenEnemies.add(i);e.time.delayedCall(t,()=>this.unfreezeEnemies(),[],this)}unfreezeEnemies(){this.scene.enemyFrozen=!1;for(const t of this.scene.frozenEnemies)t&&t.active&&(t.setTexture("enemy"),this.scene.enemyManager.startPattern(t,this.scene.enemyManager.pickPattern()));this.scene.frozenEnemies.clear(),this.scene.time.delayedCall(0,()=>this.scene.cullEnemiesOnMyHex()),this.scene.spawnTimer&&(this.scene.spawnTimer.paused=!1)}boostPlayerSpeed(t,e){const s=this.scene;if(s.speedBoostTimer){const i=s.speedBoostTimer.getRemaining();s.speedBoostTimer.remove(),t+=i}s.speedBoostTimer&&s.speedBoostTimer.remove(),s.playerSpeed=s.originalPlayerSpeed+e,s.anims.exists("speed_effect")||s.anims.create({key:"speed_effect",frames:s.anims.generateFrameNumbers("buster_effect",{start:0,end:41}),frameRate:15,repeat:-1}),s.speedEffect||(s.speedEffect=s.add.sprite(s.player.x,s.player.y,"buster_effect"),s.speedEffect.setDepth(s.player.depth-1),s.activeEffects.push(s.speedEffect)),s.speedEffect.setVisible(!0),s.speedEffect.play("speed_effect",!0),s.speedBoostTimer=s.time.delayedCall(t,()=>{s.playerSpeed=s.originalPlayerSpeed,s.player.setTexture("player"),s.speedEffect&&s.speedEffect.setVisible(!1)},[],s),s.activeTimers.push(s.speedBoostTimer)}makePlayerInvincible(t){const e=this.scene;e.shieldEffectTimer&&e.shieldEffectTimer.remove(),e.isInvincible=!0,e.anims.exists("shield_effect")||e.anims.create({key:"shield_effect",frames:e.anims.generateFrameNumbers("shield_effect",{start:0,end:33}),frameRate:20,repeat:-1}),e.shieldEffect||(e.shieldEffect=e.add.sprite(e.player.x,e.player.y,"shield_effect"),e.shieldEffect.setDepth(2),e.activeEffects.push(e.shieldEffect)),e.shieldEffect.setVisible(!0),e.shieldEffect.play("shield_effect",!0),e.shieldEffectTimer=e.time.delayedCall(t,()=>{e.isInvincible=!1,e.player.setTexture("player"),e.shieldEffect&&e.shieldEffect.setVisible(!1)},[],e),e.activeTimers.push(e.shieldEffectTimer)}}class wt extends Phaser.Scene{constructor(){super("PlayScene"),this.quizData=lt}init(t={}){this.allQuizzes=t.allQuizzes||this.quizData,this.quiz=t.quiz||Phaser.Utils.Array.GetRandom(this.allQuizzes),this.showMedalOnStart=t.showMedalOnStart||!1,this.initGameState()}preload(){this.load.image(this.quiz.answer,this.quiz.quizImage)}create(){this.cameras.main.setBackgroundColor("#E0C180"),this.initStage(),this.trailGraphics=this.add.graphics().setDepth(0),this.trailPath=[],this.player=this.physics.add.sprite(this.playerStartTile.x,this.playerStartTile.y,"player"),this.player.setCollideWorldBounds(!0),this.player.setDepth(1),this.physics.world.setBounds(0,0,this.world.w,this.world.h),this.cameras.main.setBounds(0,0,this.world.w,this.world.h),this.cameras.main.startFollow(this.player),this.dir=new Phaser.Math.Vector2(1,0),this.player.setVelocity(this.dir.x*this.playerSpeed,this.dir.y*this.playerSpeed),this.enemies=this.physics.add.group({collideWorldBounds:!0}),this.enemyManager=new xt(this),this.activeTimers=[],this.activeEffects=[];for(let t=0;t<this.enemyCount;t++)this.enemyManager.spawnEnemySimple();this.spawnTimer=this.time.addEvent({delay:3e3,callback:()=>this.enemyManager.spawnEnemySimple(),callbackScope:this,loop:!0}),this.activeTimers.push(this.spawnTimer),this.itemManager=new _t(this),this.itemManager.start(),this.miniMap=new A(this),this.physics.add.overlap(this.player,this.enemies,()=>!this.isInvincible&&this.gameOver("hit_enemy")),this.physics.add.overlap(this.player,this.itemManager.items,(t,e)=>this.itemManager.eatItem(t,e),null,this),this.showMedalOnStart&&(this.scene.pause(),this.scene.launch("MedalScene",{remainingQuizzes:this.allQuizzes}))}update(){if(this.playerMoving(),this.updateTrailPath(),this.activeEffects.forEach(t=>{t&&t.visible&&(t.x=this.player.x,t.y=this.player.y)}),!this.isInvincible&&this.checkSelfTrailCollision(this.player)){this.gameOver("hit_trail");return}!this.isInvincible&&this.checkEnemiesHitTrail()||(this.cullEnemiesOnMyHex(),this.miniMap&&this.miniMap.updateMedal())}initStage(){this.stage=new ct({scene:this,properties:{answer:this.quiz.answer}}),this.playerStartTile=this.stage.createRandomStartTerritory(),this.hexagonList=this.stage.hexagonList}drawHexBorder(t,e,s=5280511,i=4){const a=this.hexagonSize.w,n=this.hexagonSize.h,h=a/2,r=n/2,o=[{x:t-h,y:e},{x:t-h/2,y:e-r},{x:t+h/2,y:e-r},{x:t+h,y:e},{x:t+h/2,y:e+r},{x:t-h/2,y:e+r},{x:t-h,y:e}];this.trailGraphics.lineStyle(i,s,1),this.trailGraphics.beginPath(),this.trailGraphics.moveTo(o[0].x,o[0].y);for(let l=1;l<o.length;l++)this.trailGraphics.lineTo(o[l].x,o[l].y);this.trailGraphics.strokePath()}initGameState(){this.isGameOver=!1,this.world={w:b.width,h:b.height},this.canvasSize={w:D.width,h:D.height},this.hexagonSize={w:y.width,h:y.height},this.hexagonList=[],this.playerSpeed=Z,this.turnEase=K,this.isDrawing=!1,this.interval=j,this.trailWidth=J,this.trailColor=tt,this.isInvincible=!1,this.invincibilityTimer=null,this.originalPlayerSpeed=this.playerSpeed,this.speedBoostTimer=null,this.enemies=null,this.enemyCount=et,this.enemySpeed=st,this.enemyRange=it,this.enemyRadius=at,this.enemyFrozen=!1,this.frozenEnemies=new Set,this.freezeTimer=null,this.items=null,this.speedEffect=null,this.shieldEffect=null,this.activeEffects=[]}shutdown(){this.activeTimers&&(this.activeTimers.forEach(t=>t&&t.remove()),this.activeTimers=[]),this.activeEffects&&(this.activeEffects.forEach(t=>t&&t.destroy()),this.activeEffects=[])}findInnerHoles(t=!0){if(!Array.isArray(this.hexagonList)||!this.hexagonList.length)return[];const e=(o,l)=>`${o},${l}`,s=new Map;for(const o of this.hexagonList)!o||o.col==null||o.row==null||s.set(e(o.col,o.row),o);const i=(o,l,c)=>s.get(e(o.col+l,o.row+c))||null,a=o=>o%2===0?[[0,-1],[0,1],[-1,-1],[1,-1],[-1,0],[1,0]]:[[0,-1],[0,1],[-1,0],[1,0],[-1,1],[1,1]],n=o=>!!o&&o.texture?.key!=="my_hexagon"&&o.texture?.key!=="limit",h=new Set,r=[];for(const o of this.hexagonList){if(!n(o))continue;const l=e(o.col,o.row);if(h.has(l))continue;const c=[],g=[o];h.add(l);let u=!1;for(;g.length;){const d=g.shift();c.push(d);for(const[p,w]of a(d.col)){const f=i(d,p,w);if(!f){u=!0;continue}if(f.texture?.key==="limit"){u=!0;continue}if(n(f)){const P=e(f.col,f.row);h.has(P)||(h.add(P),g.push(f))}}}u||(t&&c.forEach(d=>this.markAsMyHexagon(d)),r.push(c))}return r}playerMoving(){if(!this.player||!this.player.body)return;const t=this.input.activePointer,e=this.cameras.main.getWorldPoint(t.x,t.y),s=e.x-this.player.x,i=e.y-this.player.y;if(this.isLockedOnWall){const d=new Phaser.Math.Vector2(this.player.x-this.lastCollidingHex.x,this.player.y-this.lastCollidingHex.y).normalize();new Phaser.Math.Vector2(s,i).normalize().dot(d)>.5&&(this.isLockedOnWall=!1)}const a=new Phaser.Math.Vector2(s,i);if(a.length()<1){this.player.setVelocity(0,0);return}if(a.normalize(),!this.isLockedOnWall){const d=this.game.loop.delta/1e3,p=1-Math.exp(-this.turnEase*d);this.dir.lerp(a,p)}this.dir.normalize();const n=this.dir,h=this.playerSpeed*(this.game.loop.delta/1e3),r=this.player.x+n.x*h,o=this.player.y+n.y*h;let l=!1,c=null;const g=20,u=[{x:r,y:o},{x:r+n.x*g,y:o+n.y*g},{x:r+n.y*g,y:o-n.x*g},{x:r-n.y*g,y:o+n.x*g}];for(const d of u){const p=this.getNearestHexagon(d.x,d.y);if(p&&p.texture.key==="limit"){l=!0,c=p;break}}if(!l)this.player.setVelocity(n.x*this.playerSpeed,n.y*this.playerSpeed),this.player.setAngle(Phaser.Math.RadToDeg(Math.atan2(n.y,n.x)));else{this.isLockedOnWall=!0,this.lastCollidingHex=c;const d=new Phaser.Math.Vector2(this.player.x-c.x,this.player.y-c.y),p=this.hexagonSize.w/2+g;d.setLength(p),this.player.setPosition(c.x+d.x,c.y+d.y);const w=new Phaser.Math.Vector2(this.player.x-c.x,this.player.y-c.y).normalize(),f=new Phaser.Math.Vector2(w.y,-w.x),P=new Phaser.Math.Vector2(-w.y,w.x),Tt=n.dot(f),vt=n.dot(P),k=Tt>vt?f:P;this.player.setVelocity(k.x*this.playerSpeed,k.y*this.playerSpeed),this.dir.set(k.x,k.y),this.player.setAngle(Phaser.Math.RadToDeg(Math.atan2(k.y,k.x)))}}updateTrailPath(){const t=this.player.x,e=this.player.y,s=this.isOnMyHexagon(t,e);if(!s&&!this.isDrawing?this.startTrail(t,e):!s&&this.isDrawing?this.updateTrail(t,e):s&&this.isDrawing&&this.finishTrail(),this.checkSelfTrailCollision(this.player)){this.gameOver("hit_trail");return}}checkSelfTrailCollision(t,e=6,s=this.trailWidth){const i=this.trailPath.length;if(i<3)return!1;const a=i-1-e;if(a<=0)return!1;const n=s,h=n*n;for(let r=0;r<a;r++){const o=this.trailPath[r],l=this.trailPath[r+1],c=this.pointToSegmentDistance(t.x,t.y,o.x,o.y,l.x,l.y);if(c*c<=h)return!0}return!1}pointToSegmentDistance(t,e,s,i,a,n){const h=this.squaredDistance(s,i,a,n);if(h===0)return Math.sqrt(this.squaredDistance(t,e,s,i));const r=this.clampToUnit(((t-s)*(a-s)+(e-i)*(n-i))/h),o=s+r*(a-s),l=i+r*(n-i);return Math.sqrt(this.squaredDistance(t,e,o,l))}squaredDistance(t,e,s,i){const a=t-s,n=e-i;return a*a+n*n}clampToUnit(t){return t<0?0:t>1?1:t}isOnMyHexagon(t,e){const s=this.getNearestHexagon(t,e);if(!s||s.texture?.key!=="my_hexagon")return!1;const i=s.displayWidth||this.hexagonSize.w,a=s.displayHeight||this.hexagonSize.h;return this.pointInFlatTopHex(t,e,s.x,s.y,i,a,1)}pointInFlatTopHex(t,e,s,i,a,n,h=1){const r=a*h/2,o=n*h/2,l=[s-r,i,s-r/2,i-o,s+r/2,i-o,s+r,i,s+r/2,i+o,s-r/2,i+o],c=new Phaser.Geom.Polygon(l);return Phaser.Geom.Polygon.Contains(c,t,e)}startTrail(t,e){this.isDrawing=!0,this.trailPath.length=0,this.trailPath.push({x:t,y:e}),this.trailGraphics.clear(),this.trailGraphics.fillStyle(this.trailColor,1),this.trailGraphics.fillCircle(t,e,this.trailWidth/2)}updateTrail(t,e){const s=this.trailPath[this.trailPath.length-1],i=Phaser.Math.Distance.Between(s.x,s.y,t,e);if(i<this.interval)return;this.trailPath.push({x:t,y:e});const a=Math.ceil(i/(this.trailWidth*.6));for(let n=1;n<=a;n++){const h=n/a,r=Phaser.Math.Interpolation.Linear([s.x,t],h),o=Phaser.Math.Interpolation.Linear([s.y,e],h);this.trailGraphics.fillCircle(r,o,this.trailWidth/2);const l=this.getNearestHexagon(r,o);l&&l.texture?.key!=="my_hexagon"&&l.texture?.key!=="limit"&&this.drawHexBorder(l.x,l.y)}}finishTrail(){if(this.isDrawing=!1,this.trailPath.length<5){this.trailGraphics.clear(),this.trailPath.length=0;return}this.trailGraphics.clear();const t=this.trailPath.slice(),e=this.activeHexagon(t,!1);this.paintInsideAndBorder(t,e),this.trailPath.length=0,this.findInnerHoles(!0)}paintInsideAndBorder(t,e){const s=new Set,i=a=>{if(!a||a.texture?.key==="my_hexagon")return;const n=a.col!==void 0&&a.row!==void 0?`${a.col},${a.row}`:`${a.x},${a.y}`;s.has(n)||(s.add(n),this.markAsMyHexagon(a))};for(const a of e)i(a);for(const a of t){const n=this.getNearestHexagon(a.x,a.y);i(n)}}activeHexagon(t=this.trailPath,e=!0){if(!t||t.length<3||!Array.isArray(this.hexagonList))return[];const s=t.slice(),i=s[0],a=s[s.length-1];Phaser.Math.Distance.Between(i.x,i.y,a.x,a.y)>1&&s.push({x:i.x,y:i.y});const n=[];for(const u of s)n.push(u.x,u.y);const h=new Phaser.Geom.Polygon(n),r=Phaser.Geom.Rectangle.FromPoints(s.map(u=>new Phaser.Geom.Point(u.x,u.y))),o=[],l=Math.max(1,Math.min(this.hexagonSize.w,this.hexagonSize.h)*.35),c=8,g=(u,d)=>{if(Phaser.Geom.Polygon.Contains(h,u,d))return!0;for(let p=0;p<c;p++){const w=Math.PI*2*p/c,f=u+l*Math.cos(w),P=d+l*Math.sin(w);if(Phaser.Geom.Polygon.Contains(h,f,P))return!0}return!1};for(const u of this.hexagonList){const{x:d,y:p}=u;Phaser.Geom.Rectangle.Contains(r,d,p)&&g(d,p)&&o.push(u)}return e&&o.forEach(u=>this.markAsMyHexagon(u)),o}getNearestHexagon(t,e){let s=null,i=1/0;for(const a of this.hexagonList){const n=Phaser.Math.Distance.Between(t,e,a.x,a.y);n<i&&(i=n,s=a)}return s}getClosestWallToPoint(t){let e=null,s=1/0;const i=this.playerBoundsHexagon.points;for(let a=0;a<i.length;a++){const n=i[a],h=i[(a+1)%i.length],r=new Phaser.Geom.Line(n.x,n.y,h.x,h.y),o=new Phaser.Geom.Point;Phaser.Geom.Line.GetNearestPoint(r,t,o);const l=Phaser.Math.Distance.Between(t.x,t.y,o.x,o.y);l<s&&(s=l,e=r)}return e}gameOver(t="hit_trail"){this.isGameOver||(z.stop(),this.sound.play("lose"),this.isGameOver=!0,this.physics.world.pause(),this.player.setVelocity(0,0),this.isDrawing=!1,this.spawnTimer?.remove(),this.tweens.add({targets:this.player,alpha:{from:1,to:.2},yoyo:!0,duration:100,repeat:4}),this.time.delayedCall(350,()=>{this.scene.pause(),this.scene.launch("GameOverScene",{reason:t})}))}cullEnemiesOnMyHex(){if(!this.enemies)return;const t=this.enemies.getChildren();for(let e=t.length-1;e>=0;e--){const s=t[e];!s||!s.active||this.isOnMyHexagon(s.x,s.y)&&this.fadeOutAndRemoveEnemy(s)}}fadeOutAndRemoveEnemy(t){t.pendingRemoval||(t.pendingRemoval=!0,this.tweens.killTweensOf(t),t.setVelocity?.(0,0),t.body&&(t.body.enable=!1),this.tweens.add({targets:t,alpha:{from:1,to:.2},yoyo:!0,duration:120,repeat:4,onComplete:()=>{this.tweens.killTweensOf(t),t.destroy()}}))}checkEnemiesHitTrail(){if(!this.enemies||!this.isDrawing)return;const t=this.trailPath.length;if(t<2)return!1;const e=this.enemies.getChildren();if(!e||e.length===0)return!1;for(let s=0;s<e.length;s++){const i=e[s];if(!i||!i.active||i.pendingRemoval)continue;const a=this.trailWidth*.5+this.enemyRadius;for(let n=0;n<t;n+=1){const h=this.trailPath[n],r=i.x-h.x,o=i.y-h.y;if(r*r+o*o<=a*a)return this.gameOver("enemy_hit_trail"),!0}}return!1}markAsMyHexagon(t){t&&(t.texture?.key==="my_hexagon"||t.texture?.key==="limit"||(t.setTexture("my_hexagon"),t.setDepth&&t.setDepth(1),this.stage&&typeof this.stage.updateQuizMask=="function"&&this.stage.updateQuizMask()))}}const O={fontSize:"60px",fontFamily:nt},B={...O,color:"#fddc3e"},M={...O,color:"#ffffff"},H={...O,color:"#c4a5fd"},W={hit_enemy:[{text:"꿀벌",style:B},{text:"이 ",style:M},{text:"적",style:H},{text:"과 부딪혔어요!",style:M}],hit_trail:[{text:"꿀벌",style:B},{text:"이 ",style:M},{text:"선",style:H},{text:"에 닿았어요!",style:M}],enemy_hit_trail:[{text:"적",style:B},{text:"이 ",style:M},{text:"선",style:H},{text:"에 닿았어요!",style:M}],default:[{text:"꿀벌",style:B},{text:"이 ",style:M},{text:"선",style:H},{text:"에 닿았어요!",style:M}]},F=[`아쉬워!
할 수 있었는데!`,`아까워!
실수한 거야!`,`아,
잘하고 있었는데!`,`다시 해보자!
할 수 있어!`,`괜찮아,
다시 하면 돼!`,`다음엔
꼭 성공한다!`,`조금 어렵지만
할 수 있어!`,`침착하게
다시 해보자!`,`포기 안 해!
다시 할거야!`,`이제 알겠어!
다시 도전!`,`감 잡았어!
이번엔 성공할거야!`,`앗! 아깝다~!
다시 도전!`,`실수할 수도 있지!
다시 하자!`];class bt extends Phaser.Scene{constructor(){super("GameOverScene")}init(t){this.reason=t.reason}create(){this.centerX=this.cameras.main.width/2,this.centerY=this.cameras.main.height/2,E(this,0,.7),this.createUI(),this.createText(),this.createButton()}initBackground(){const t=this.add.graphics();t.fillStyle(0,.7),t.fillRect(0,0,this.sys.game.config.width,this.sys.game.config.height)}createUI(){this.add.image(this.centerX,this.centerY-130,"game_over_bee"),this.add.image(915,167,"game_over_balloon"),this.add.image(this.centerX,this.centerY+100,"game_over_text_box")}createText(){this.createResonText(),this.createBalloonText()}createButton(){const t=this.add.sprite(this.centerX,this.centerY+260,"return_button").setInteractive({useHandCursor:!0});t.on("pointerover",()=>t.setFrame(1)),t.on("pointerout",()=>t.setFrame(0)),t.on("pointerdown",()=>this.chageScene())}chageScene(){this.scene.stop("GameOverScene"),this.scene.start("StartScene")}createResonText(){const t=W[this.reason]||W.default,e=this.add.container(0,0);let s=0;for(const a of t){const n=this.add.text(0,0,a.text,a.style);n.setX(s),s+=n.width,e.add(n)}const i=e.getBounds();e.setPosition(this.centerX-i.width/2,this.centerY+50)}createBalloonText(){const t=Math.floor(Math.random()*F.length),e=F[t],s=this.add.container(0,0),i=this.add.text(0,0,e,{fontSize:"32px",fontFamily:rt,color:"#000000",align:"center"}),a=i.getBounds();i.setPosition(-a.width/2,-a.height/2),s.add(i),s.setPosition(this.centerX+280,this.centerY-210)}}const v={main:"#ee5d62",hover:"#4d8900",white:"#ffffff",black:"#000000"};class St extends Phaser.Scene{constructor(){super("QuizScene")}init(t){this.quiz=t.quiz,this.allQuizzes=t.allQuizzes,this.canvasSize=t.canvasSize,this.medalNumber=t.medalNumber}create(){const t=document.querySelector("canvas");t.style.transition="opacity 0.2s",setTimeout(()=>{t.style.opacity="1",t.style.transition="",this.add.image(this.scale.width/2,this.scale.height/2,"quiz_bg").setScale(_).setDepth(-1)},20);for(let e=1;e<=4;e++)this.createAnimation(e);this.createAnimation("incorrect"),this.add.image(292,56,`medal_${this.medalNumber}`).setScale(.5),this.textures.exists("worldSnapshot")&&(this.snapshotImage=this.renderMaskedImage("worldSnapshot")),this.renderAnswerButtons(),this.exitButton=this.renderFeedbackButton("exit_btn",()=>this.returnToPlayScene())}createHexMaskGraphics(t,e,s){const i=this.make.graphics({x:0,y:0,add:!1}),a=t+s/2,n=e+s/2,h=s/2;i.beginPath();for(let r=0;r<6;r++){const o=Phaser.Math.DegToRad(60*r+30),l=a+h*Math.cos(o),c=n+h*Math.sin(o);r===0?i.moveTo(l,c):i.lineTo(l,c)}return i.closePath(),i.fillPath(),i}renderMaskedImage(t){const{w:e,h:s}=this.canvasSize,i=this.add.image(e/2,s/2,t).setOrigin(0,0),a=100,n=s/4,o=this.createHexMaskGraphics(108,n,482).createGeometryMask();return i.setScale(_).setPosition(a,n).setMask(o),this.add.image(136,178,"map_bg").setOrigin(0,0).setScale(_),i}renderAnswerButtons(){const t=this.quiz.answer,e=Phaser.Utils.Array.Shuffle([...this.quiz.options]),s=this.canvasSize.w/2+270,i=270;this.itemButtonGroup=this.add.group(),e.forEach((a,n)=>{const h=s,r=i+n*120,o=this.createAnswerButton(h,r,a,()=>{this.itemButtonGroup.children.iterate(l=>l.disableInteractive&&l.disableInteractive()),this.exitButton&&this.exitButton.active&&this.exitButton.destroy(),a===t?this.correct():this.incorrect()});this.itemButtonGroup.add(o)})}createAnswerButton(t,e,s,i){const a=this.createButtonImage(t,e,"word_bg",i),n=this.createButtonText(t,e-10,s);return this.applyButtonHoverEffect(a,n),a}createButtonImage(t,e,s,i){const a=this.add.image(t,e,s).setInteractive({useHandCursor:!0}).setScale(_);return a.on("pointerdown",i),a}createButtonText(t,e,s){const i=this.add.text(t,e,s,{fontSize:"44px",fontFamily:ot,color:v.white,fontStyle:"bold"}).setOrigin(.5);return i.setShadow(3,3,v.main,0,!0,!0),i}applyButtonHoverEffect(t,e){t.on("pointerover",()=>{t.setTexture("word_bg_h"),e.setColor(v.hover),e.setShadow(0,0,v.black,0,!1,!1),this.setCursor("pointer")}),t.on("pointerout",()=>{t.setTexture("word_bg"),e.setColor(v.white),e.setShadow(3,3,v.main,0,!0,!0),this.setCursor("default")})}setCursor(t="default"){this.input&&this.input.setDefaultCursor&&this.input.setDefaultCursor(t)}correct(){this.handleAnswerResult(!0)}incorrect(){this.handleAnswerResult(!1)}handleAnswerResult(t){this.setCursor("default"),this.sound.play(t?"correct":"incorrect"),t&&(this.increaseMedalCount(this.medalNumber),this.showAnswerImage(this.snapshotImage)),this.showFeedback(t);const e=t?"next_btn":"main_btn";this.renderFeedbackButton(e,()=>this.goToNextQuiz())}showAnswerImage(t){const{x:e,y:s,mask:i}=t;t.destroy();const a=this.add.image(e,s,"worldSnapshotNoHexagon").setAlpha(0).setOrigin(0,0);a.setScale(_).setPosition(e,s).setMask(i),this.tweens.add({targets:a,alpha:1,duration:1e3,ease:"Linear"}),this.add.image(136,178,"map_bg").setOrigin(0,0).setScale(_)}goToNextQuiz(){this.sound.play("click"),this.scene.stop("PlayScene"),this.scene.stop("QuizScene");const t=this.allQuizzes.filter(e=>e.answer!==this.quiz.answer);t.length===0?this.scene.start("PlayScene",{quiz:this.quiz,allQuizzes:t,showMedalOnStart:!0,medalNumber:this.medalNumber}):this.scene.start("PlayScene",{allQuizzes:t,showMedalOnStart:!0,medalNumber:this.medalNumber})}returnToPlayScene(){this.scene.stop("QuizScene"),this.scene.resume("PlayScene")}renderFeedbackButton(t,e){const s=this.canvasSize.w-270,i=this.canvasSize.h-50,a=this.add.image(s,i,t).setOrigin(1,1).setInteractive({useHandCursor:!0}).setScale(_);return a.on("pointerdown",()=>e()),T(a,`${t}`),a}showFeedback(t){const e=this.medalNumber,s=t?{img:`medal_${e}_1`,ani:`medal_${e}_ani`,txt:`text_${e}`}:{img:"bee_incorrect",ani:"incorrect_ani",txt:"text_incorrect"},i=E(this).setDepth(1).setInteractive(new Phaser.Geom.Rectangle(0,0,this.canvasSize.w,this.canvasSize.h),Phaser.Geom.Rectangle.Contains),a=this.add.sprite(this.canvasSize.w/2,this.canvasSize.h/2,s.img).setOrigin(.5).setDepth(2);a.play(s.ani);const n=this.add.image(this.canvasSize.w/2,this.canvasSize.h-100,s.txt).setOrigin(.5).setDepth(2).setScale(_);let h=0;a.on("animationrepeat",()=>{h++,h===1&&this.tweens.add({targets:[a,n,i],alpha:0,duration:1e3,ease:"Linear",onComplete:()=>{a.destroy(),n.destroy(),i.destroy()}})})}createAnimation(t){const[e,s]=t==="incorrect"?["incorrect_ani","incorrect_"]:[`medal_${t}_ani`,`medal_${t}_`];if(this.anims.exists(e))return;const i=Array.from({length:5},(a,n)=>this.anims.generateFrameNumbers(`${s}${n+1}`,{start:0,end:17})).flat();this.anims.create({key:e,frames:i,frameRate:20,repeat:-1})}increaseMedalCount(t){let e=this.registry.get("myMedals")||{1:0,2:0,3:0,4:0};e[t]++,this.registry.set("myMedals",e)}}const Pt={fontSize:"24px",color:"#804515",fontFamily:q},C={fontSize:"40px",color:"#11390E",fontFamily:q},Q={fontSize:"40px",color:"#FFD33C",fontFamily:q,stroke:"#942D05",strokeThickness:5,padding:{x:0,y:-3}},Y={default:[{text:"숨겨진 ",style:C},{text:"그림의 정체를 ",style:Q},{text:"밝혀내라!",style:C}],finish:[{text:"숨겨진 ",style:C},{text:"그림의 정체를 ",style:Q},{text:"모두 밝혔다!",style:C}]};class zt extends Phaser.Scene{constructor(){super("MedalScene")}init(t){this.remainingQuizzes=t.remainingQuizzes}create(){this.centerX=this.cameras.main.width/2,this.centerY=this.cameras.main.height/2,E(this,0,.7),this.createUI(),this.createButton(),this.initBgm()}initBgm(){z.isOn?z.play():z.stop()}createButton(){const t=this.remainingQuizzes?.length>0?"start_button":"reset_button";this.actionButton=this.add.image(this.centerX,640,t).setInteractive({useHandCursor:!0}),this.homeButton=this.add.image(50,50,"home_button").setInteractive({useHandCursor:!0}),I(this.homeButton),I(this.actionButton),this.homeButton.on("pointerdown",()=>{this.sound.play("click"),this.scene.start("StartScene")}),this.actionButton.on("pointerdown",()=>{this.sound.play("click"),this.changeScene()}),this.createBgmButton()}changeScene(){this.remainingQuizzes?.length>0?(this.scene.stop("MedalScene"),this.scene.resume("PlayScene")):(this.scene.stop("PlayScene"),this.scene.stop("MedalScene"),this.scene.start("StartScene"))}createUI(){this.add.image(this.centerX,this.centerY-30,"medal_bg"),this.createResultText(),this.createMedalBox()}createMedalBox(){const t=this.registry.get("myMedals")||{1:0,2:0,3:0,4:0};[{x:this.centerX-267,y:390,medalId:1},{x:this.centerX-85,y:390,medalId:2},{x:this.centerX+96,y:390,medalId:3},{x:this.centerX+277,y:390,medalId:4}].forEach(s=>{const{key:i,x:a,y:n,medalId:h}=s;this.add.text(s.x,n+70,`${t[h]}`,Pt).setOrigin(.5)})}createResultText(){const t=this.remainingQuizzes?.length>0?Y.default:Y.finish,e=this.add.container(0,0);let s=0;for(const a of t){const n=this.add.text(0,0,a.text,a.style);n.setX(s),s+=n.width,e.add(n)}const i=e.getBounds();e.setPosition(this.centerX-i.width/2,this.centerY+130)}createBgmButton(){this.bgmButton=this.add.image(1243,686,"volume_button").setInteractive({useHandCursor:!0}).setScrollFactor(0),this.updateBgmButtonTexture(!z.isOn),I(this.bgmButton),this.bgmButton.on("pointerdown",()=>{z.toggle(),this.updateBgmButtonTexture(!z.isOn),this.sound.play("click")})}updateBgmButtonTexture(t){this.bgmButton.setTexture(t?"mute_button":"volume_button")}}const Mt={type:Phaser.WEBGL,width:1280,height:720,parent:"gameContainer",backgroundColor:"0xc9effa",scene:[V,$,U,ht,wt,bt,St,zt],physics:{default:"arcade",arcade:{debug:!1}},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH}};new Phaser.Game(Mt)})();
