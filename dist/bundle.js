(function(){"use strict";class X extends Phaser.Scene{constructor(){super("Boot")}preload(){this.load.spritesheet("loading","assets/img/start/ice_spritesheet.png",{frameWidth:105,frameHeight:128}),this.load.image("logo","assets/img/start/icecandy_logo.png")}create(){const{width:t,height:e}=this.scale,s=this.add.rectangle(0,0,t,e,13234170).setOrigin(0,0),i=this.add.image(t/2,e/2,"logo").setAlpha(0).setScale(.7);i.setY(i.y+100),this.tweens.add({targets:i,alpha:1,y:"-=120",duration:150,ease:"ease-in-out",repeat:0,onComplete:()=>{this.tweens.add({targets:i,alpha:1,y:"+=20",duration:100,ease:"ease-in-out",repeat:0})}}),this.time.delayedCall(1200,()=>{this.tweens.add({targets:[i,s],alpha:0,duration:200,ease:"ease-in-out",repeat:0})}),this.time.delayedCall(1500,()=>this.scene.start("Preloader"))}}class Q{constructor(){this.bgm=null,this.isOn=!0}init(t,e,s){this.bgm||(this.bgm=t.sound.add(e,{...s}))}play(){this.bgm.isPlaying||this.bgm.play()}toggle(){this.bgm&&(this.isOn?(this.bgm.pause(),this.isOn=!1):(this.bgm.isPaused?this.bgm.resume():this.bgm.play(),this.isOn=!0))}pause(){this.bgm?.isPlaying&&this.bgm.pause()}stop(){this.bgm.stop(),this.isOn=!1}resume(){this.bgm&&!this.bgm.isPlaying&&this.bgm.resume()}}const E=new Q;class U extends Phaser.Scene{constructor(){super("Preloader")}init(){this.cameras.main.setBackgroundColor(13234170);const t=9751772,e={width:500,height:30},s={x:this.scale.width/2-e.width/2,y:this.scale.height/2-e.height/2},i=e.height/2,a=8,n={width:e.width+a,height:e.height+a},h=i+a,o={x:s.x-a/2,y:s.y-a/2},r=this.add.graphics({fillStyle:{color:16777215},lineStyle:{width:3,color:t}});r.fillRoundedRect(o.x,o.y,n.width,n.height,h),r.strokeRoundedRect(o.x,o.y,n.width,n.height,h);const l=this.add.graphics({fillStyle:{color:t}});l.fillRoundedRect(s.x,s.y,e.height,e.height,i),this.anims.create({key:"loading",frames:this.anims.generateFrameNumbers("loading",{start:1,end:4}),frameRate:12,repeat:-1});const c=this.add.sprite(0,0,"loading").play("loading");c.setScale(.5),c.y=s.y+e.height/2-c.height/2+14,this.load.on("progress",g=>{const d=Math.max(e.height,e.width*g);l.clear(),l.fillRoundedRect(s.x,s.y,d,e.height,i),c.x=s.x+d-e.height/2})}preload(){this.load.audio("bgm_audio","./assets/mp3/bgm.mp3"),this.load.audio("click","./assets/mp3/click.mp3"),this.load.image("bgm_O","assets/img/start/bgm_O.png"),this.load.image("bgm_X","assets/img/start/bgm_X.png"),this.load.image("bg","assets/img/start/start_bg.png"),this.load.image("start_title","assets/img/start/start_title.png"),this.load.image("start_char","assets/img/start/start_char.png"),this.load.spritesheet("start_btn","assets/img/start/start_btn.png",{frameWidth:383.5,frameHeight:143}),this.load.spritesheet("how_btn","assets/img/start/howToPlay_btn.png",{frameWidth:141,frameHeight:122}),this.load.image("howToPlay","assets/img/start/howToPlay.png"),this.load.image("close_btn","assets/img/start/close_btn.png"),this.load.image("close_btn_h","assets/img/start/close_btn_h.png"),this.load.image("play_btn","assets/img/help/play_btn.png"),this.load.image("pause_btn","assets/img/help/pause_btn.png"),this.load.image("help_next_btn","assets/img/help/next_btn.png"),this.load.image("help_next_btn_h","assets/img/help/next_btn_h.png"),this.load.image("help_prev_btn","assets/img/help/prev_btn.png"),this.load.image("help_prev_btn_h","assets/img/help/prev_btn_h.png"),this.load.video("help-video-1","assets/img/video/semple.mp4"),this.load.video("help-video-2","assets/img/video/semple.mp4"),this.load.video("help-video-3","assets/img/video/semple.mp4"),this.load.video("help-video-4","assets/img/video/semple.mp4"),this.load.image("hexagon","assets/img/play/hexagon.png"),this.load.image("limit","assets/img/play/limit.png"),this.load.image("my_hexagon","assets/img/play/hexagon_h.png"),this.load.image("player","assets/img/play/player.png"),this.load.image("player_speed","assets/img/play/player_speed.png"),this.load.image("player_invincible","assets/img/play/player_invincible.png"),this.load.image("enemy","assets/img/play/enemy.png"),this.load.image("enemy_freeze","assets/img/play/enemy_freeze.png"),this.load.image("item_freeze","assets/img/play/freeze.png"),this.load.image("item_speed","assets/img/play/speed.png"),this.load.image("item_invincible","assets/img/play/invincible.png"),this.load.spritesheet("buster_effect","assets/img/play/buster_effect.png",{frameWidth:200,frameHeight:200}),this.load.spritesheet("shield_effect","assets/img/play/shield_effect.png",{frameWidth:200,frameHeight:200}),this.load.spritesheet("quiz_start","assets/img/play/quiz_start.png",{frameWidth:274,frameHeight:99}),this.load.image("bee_gameOver","assets/img/over/bee.png"),this.load.image("balloon_gameOver","assets/img/over/balloon.png"),this.load.image("text_box","assets/img/over/text_box.png"),this.load.spritesheet("return_btn","assets/img/over/return_btn.png",{frameWidth:361.5,frameHeight:134}),this.load.image("bee_incorrect","assets/img/quiz/bee_incorrect.png"),this.load.image("bee_correct","assets/img/quiz/bee_correct.png"),this.load.spritesheet("bee_fail","assets/img/quiz/bee_fail.png",{frameWidth:170,frameHeight:223}),this.load.spritesheet("bee_win","assets/img/quiz/bee_win.png",{frameWidth:520,frameHeight:591}),this.load.image("medal_1","assets/img/quiz/medal_1.png"),this.load.image("medal_2","assets/img/quiz/medal_2.png"),this.load.image("medal_3","assets/img/quiz/medal_3.png"),this.load.image("medal_4","assets/img/quiz/medal_4.png"),this.load.image("main_btn","assets/img/quiz/mainPage_btn.png"),this.load.image("main_btn_h","assets/img/quiz/mainPage_btn_h.png"),this.load.image("next_btn","assets/img/quiz/next_btn.png"),this.load.image("next_btn_h","assets/img/quiz/next_btn_h.png"),this.load.image("exit_btn","assets/img/quiz/exit_btn.png"),this.load.image("exit_btn_h","assets/img/quiz/exit_btn_h.png"),this.load.audio("correct","assets/mp3/correct.mp3"),this.load.audio("incorrect","assets/mp3/incorrect.mp3"),this.load.image("medal_1","assets/img/quiz/medal_1.png"),this.load.image("medal_2","assets/img/quiz/medal_2.png"),this.load.image("medal_3","assets/img/quiz/medal_3.png"),this.load.image("medal_4","assets/img/quiz/medal_4.png"),this.load.image("reset_btn","assets/img/medal/reset_btn.png"),this.load.image("reset_btn_h","assets/img/medal/reset_btn_h.png"),this.load.image("home_btn","assets/img/medal/home_btn.png"),this.load.image("bee_medal","assets/img/medal/bee_medal.png")}create(){this.initBgm(),this.time.delayedCall(500,()=>{this.scene.start("StartScene")})}initBgm(){E.init(this,"bgm_audio",{loop:!0,volume:.05})}}const C=(m,t=0,e=.5)=>{const{width:s,height:i}=m.sys.game.config;return m.add.rectangle(0,0,s,i,t,e).setOrigin(0,0).setDepth(0)},k=(m,t,e)=>{const s=`${t}_h`,i=m.scene;!i.textures.exists(t)||!i.textures.exists(s)||(m.on("pointerover",()=>m.setTexture(s)),m.on("pointerout",()=>m.setTexture(t)))},I=m=>{m.on("pointerover",()=>m.setFrame(1)),m.on("pointerout",()=>m.setFrame(0))},R=m=>m<=5?1:m<=15?2:m<=30?3:4,w={TITLE:{x:640,y:220,scale:.6},CHAR:{x:600,y:450,scale:.6},START_BTN:{x:640,y:630,scale:.6667},HOW_BTN:{x:1180,y:100,scale:.6667}};class $ extends Phaser.Scene{constructor(){super("StartScene")}create(){this.initScene(),this.createBackground(),this.createUI(),this.createButtons()}initScene(){this.registry.set("myMedals",{1:0,2:0,3:0,4:0}),["PlayScene","QuizScene","GameOverScene","MedalScene"].forEach(t=>this.scene.stop(t))}createBackground(){const{width:t,height:e}=this.sys.game.config,s=this.add.image(0,0,"bg").setOrigin(0),i=Math.max(t/s.width,e/s.height);s.setScale(i).setScrollFactor(0)}createUI(){this.add.image(w.TITLE.x,w.TITLE.y,"start_title").setScale(w.TITLE.scale),this.add.image(w.CHAR.x,w.CHAR.y,"start_char").setScale(w.CHAR.scale)}createButtons(){this.createStartButton(),this.createHowToPlayButton()}createStartButton(){const t=this.add.sprite(w.START_BTN.x,w.START_BTN.y,"start_btn",0).setInteractive({useHandCursor:!0}).setScale(w.START_BTN.scale);t.on("pointerdown",()=>{this.sound.play("click"),this.cameras.main.fadeOut(200,255,255,255),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("PlayScene",{showMedalOnStart:!0})})}),I(t)}createHowToPlayButton(){const t=this.add.sprite(w.HOW_BTN.x,w.HOW_BTN.y,"how_btn",0).setInteractive({useHandCursor:!0}).setScale(w.HOW_BTN.scale);t.on("pointerdown",()=>this.scene.launch("HelpScene")),I(t)}}const P={width:2880,height:2880},x={width:64,height:55},M="Cafe24Surround",b={OVERLAY:0,OVERLAY_ALPHA:.7,HELP_BG:16777215,VIDEO_BG:16777215,TEXT:"#000000",NAV_BG:8947848,DOT_INACTIVE:13421772,DOT_HOVER:11184810,DOT_ACTIVE:3355443},T={HELP_BOX:{width:900,height:600},CLOSE_BTN:{offsetX:420,offsetY:-280,scale:.8},VIDEO_BOX:{width:600,height:338,offsetY:-80,scale:.3},TEXT:{startY:140,spacing:40,fontSize:"22px"},NAV_BTN:{offsetX:350,radius:25,scale:.4,depth:{bg:99,btn:100}},INDICATOR:{offsetY:250,spacing:30,radius:{normal:6,active:8}}},W=[{videoId:"help-video-1",texts:["마우스를 움직이면 꿀벌이 따라와요.","꿀벌이 선을 그어 표시한 곳은 숨겨진 그림이 드러나요."]},{videoId:"help-video-2",texts:["도전하기 버튼을 눌러 그림의 정체를 맞추면 메달을 얻을 수 있어요.","그림의 정체를 맞추지 못하면 게임이 끝나요."]},{videoId:"help-video-3",texts:["말벌과 부딪히면 게임이 끝나요.","선에 말벌이나 꿀벌이 닿아도 게임이 끝나요."]},{videoId:"help-video-4",texts:["아이템을 먹으면 다양한 효과를 얻을 수 있어요."]}];class Z extends Phaser.Scene{constructor(){super("HelpScene"),this.totalPages=W.length,this.currentPage=0,this.videoElements=[],this.pages=[],this.pageIndicators=[]}create(){this.initScene(),this.createUI(),this.createPages(),this.createNavigationButtons(),this.createPageIndicator(),this.showPage(0)}initScene(){const{width:t,height:e}=this.sys.game.config;this.centerX=t/2,this.centerY=e/2,this.cleanup(),this.videoElements=[],this.pages=[],this.pageIndicators=[],this.currentPage=0}createUI(){C(this,b.OVERLAY,b.OVERLAY_ALPHA).setInteractive(),this.add.rectangle(this.centerX,this.centerY,T.HELP_BOX.width,T.HELP_BOX.height,b.HELP_BG),this.createCloseButton()}createCloseButton(){const{offsetX:t,offsetY:e,scale:s}=T.CLOSE_BTN,i=this.add.image(this.centerX+t,this.centerY+e,"close_btn").setInteractive({useHandCursor:!0}).setScale(s);k(i,"close_btn"),i.on("pointerdown",()=>{this.videoElements.forEach(a=>a.isPlaying()&&a.stop()),this.scene.stop()})}createPages(){W.forEach((t,e)=>{const s=this.add.container(this.centerX,this.centerY),{width:i,height:a,offsetY:n,scale:h}=T.VIDEO_BOX,o=this.add.rectangle(0,n,i,a,b.VIDEO_BG),r=this.add.video(0,n,t.videoId).setOrigin(.5).setLoop(!0).setScale(h);this.videoElements.push(r),s.add([o,r]),t.texts.forEach((l,c)=>{const{startY:g,spacing:d,fontSize:p}=T.TEXT,u=this.add.text(0,g+c*d,l,{fontSize:p,fontFamily:M,color:b.TEXT,align:"center",wordWrap:{width:800}}).setOrigin(.5);s.add(u)}),s.setVisible(!1),this.pages[e]=s})}createNavigationButtons(){const{offsetX:t,radius:e,scale:s,depth:i}=T.NAV_BTN;[{x:-t,btn:"prevButton",bg:"prevBg",key:"help_prev_btn",action:()=>this.prevPage()},{x:t,btn:"nextButton",bg:"nextBg",key:"help_next_btn",action:()=>this.nextPage()}].forEach(({x:n,btn:h,bg:o,key:r,action:l})=>{this[o]=this.add.circle(this.centerX+n,this.centerY,e,b.NAV_BG).setDepth(i.bg),this[h]=this.add.image(this.centerX+n,this.centerY,r).setInteractive({useHandCursor:!0}).setDepth(i.btn).setScale(s),k(this[h],r),this[h].on("pointerdown",l)})}createPageIndicator(){this.pageIndicators=[];const{offsetY:t,spacing:e,radius:s}=T.INDICATOR,i=this.centerX-(this.totalPages-1)*e/2;for(let a=0;a<this.totalPages;a++){const n=this.add.circle(i+a*e,this.centerY+t,s.normal,b.DOT_INACTIVE).setInteractive({useHandCursor:!0});n.on("pointerdown",()=>this.showPage(a)),n.on("pointerover",()=>this.currentPage!==a&&n.setFillStyle(b.DOT_HOVER)),n.on("pointerout",()=>this.currentPage!==a&&n.setFillStyle(b.DOT_INACTIVE)),this.pageIndicators.push(n)}}showPage(t){this.pages.forEach(s=>{s.setVisible(!1),s.setAlpha(0)}),this.currentPage=t;const e=this.pages[t];e&&(e.setVisible(!0),this.tweens.add({targets:e,alpha:1,duration:300,ease:"Cubic.easeOut"})),this.updateNavigationButtons(t),this.updatePageIndicators(t),this.playVideo(t)}updateNavigationButtons(t){const e=t===0,s=t===this.totalPages-1;this.prevButton.setVisible(!e),this.prevBg.setVisible(!e),this.nextButton.setVisible(!s),this.nextBg.setVisible(!s)}updatePageIndicators(t){const{radius:e}=T.INDICATOR;this.pageIndicators.forEach((s,i)=>{const a=i===t;s.setFillStyle(a?b.DOT_ACTIVE:b.DOT_INACTIVE),s.setRadius(a?e.active:e.normal)})}playVideo(t){this.videoElements.forEach((e,s)=>{e.isPlaying()&&e.stop(),s===t&&(e.setCurrentTime(0),e.setVolume(0),e.play())})}prevPage(){this.currentPage>0&&this.showPage(this.currentPage-1)}nextPage(){this.currentPage<this.totalPages-1&&this.showPage(this.currentPage+1)}cleanup(){this.videoElements?.forEach(t=>t?.destroy()),this.pages?.forEach(t=>t?.destroy()),this.pageIndicators?.forEach(t=>t?.destroy()),this.prevButton?.destroy(),this.nextButton?.destroy(),this.prevBg?.destroy(),this.nextBg?.destroy()}}const H=64,L=55,K=62,j=54,J=(K-1)*(H*.75)+H,tt=(j-1)*L+L,A={WORLD_W:J,WORLD_H:tt,HEXAGON_W:H,HEXAGON_H:L,CANVAS_W:1280,CANVAS_H:720,PLAY_SPEED:150,TURN_EASE:5,LINE_INTERVAL:10,TRAIL_WIDTH:10,TRAIL_COLOR:"0xff3366",EARLY_ENEMY_COUNT:30,EARLY_ENEMY_SPEED:60,EARLY_ENEMY_RANGE:100,EARLY_ENEMY_RADIUS:10},et=[{answer:"banana",quizImage:"assets/img/play/world/banana.png",fullImage:"assets/img/play/world/banana_full.png",options:["bread","banana","potato"]},{answer:"diamond",quizImage:"assets/img/play/world/diamond.png",fullImage:"assets/img/play/world/diamond_full.png",options:["ice","diamond","mountain"]},{answer:"duck",quizImage:"assets/img/play/world/duck.png",fullImage:"assets/img/play/world/duck_full.png",options:["duck","snake","rabbit"]},{answer:"fan",quizImage:"assets/img/play/world/fan.png",fullImage:"assets/img/play/world/fan_full.png",options:["fan","net","basket"]},{answer:"sandwich",quizImage:"assets/img/play/world/sandwich.png",fullImage:"assets/img/play/world/sandwich_full.png",options:["cake","cutlet","sandwich"]},{answer:"scissors",quizImage:"assets/img/play/world/scissors.png",fullImage:"assets/img/play/world/scissors_full.png",options:["clock","scissors","skate shoes"]},{answer:"umbrella",quizImage:"assets/img/play/world/umbrella.png",fullImage:"assets/img/play/world/umbrella_full.png",options:["glass","spider","umbrella"]},{answer:"pencil",quizImage:"assets/img/play/world/pencil.png",fullImage:"assets/img/play/world/pencil_full.png",options:["wood","cookie","pencil"]},{answer:"ant",quizImage:"assets/img/play/world/ant.png",fullImage:"assets/img/play/world/ant_full.png",options:["scorpion","ant","butterfly"]},{answer:"book",quizImage:"assets/img/play/world/book.png",fullImage:"assets/img/play/world/book_full.png",options:["sun","gold","book"]}];class st{constructor({scene:t,properties:e}){this.scene=t,this.hexagonList=[],this.hexagonMap=new Map,this.answer=e.answer,this.tileWidth=x.width*.75,this.tileHeight=x.height,this.radiusByWidth=P.width/this.tileWidth/2,this.radiusByHeight=P.height/this.tileHeight/2,this.mapRadius=Math.floor(Math.min(this.radiusByWidth,this.radiusByHeight))-1,this.init()}init(){this.initQuizBg(),this.createHexagon(),this.createHexMask(),this.createQuizMask()}createQuizMask(){if(this.quizMaskGraphics=this.scene.make.graphics({add:!1}),this.updateQuizMask(),this.quizBg){const t=new Phaser.Display.Masks.GeometryMask(this.scene,this.quizMaskGraphics);this.quizBg.setMask(t)}}updateQuizMask(){if(this.quizMaskGraphics){this.quizMaskGraphics.clear();for(const t of this.hexagonList){if(t.texture&&t.texture.key!=="my_hexagon")continue;const e=t.x,s=t.y,i=this.getHexPoints(e,s,x.width,x.height);this.quizMaskGraphics.fillStyle(16777215,1),this.quizMaskGraphics.beginPath(),this.quizMaskGraphics.moveTo(i[0],i[1]);for(let a=2;a<i.length;a+=2)this.quizMaskGraphics.lineTo(i[a],i[a+1]);this.quizMaskGraphics.closePath(),this.quizMaskGraphics.fillPath()}}}initQuizBg(){this.quizBg=this.scene.add.image(P.width/2,P.height/2,this.answer).setDepth(0).setVisible(!0),this.bgDim=this.scene.add.graphics(),this.bgDim.fillStyle(0,.45).fillRect(0,0,P.width,P.height).setDepth(-10)}createHexMask(){const t=this.scene.make.graphics({add:!1});this.hexagonList.forEach(s=>{const{x:i,y:a,texture:n}=s;if(n.key==="limit")return;const h=this.getHexPoints(i,a,x.width,x.height),o=new Phaser.Geom.Polygon(h);t.fillPoints(o.points,!0)});const e=new Phaser.Display.Masks.GeometryMask(this.scene,t);this.bgDim.setMask(e)}createHexagon(){const t=Math.ceil((P.width+x.width)/this.tileWidth),e=Math.ceil((P.height+x.height/2)/x.height),s={col:Math.floor(t/2),row:Math.floor(e/2)},i=this.offsetToCube(s.col,s.row),a=(t-1)*this.tileWidth+x.width,n=(e-1)*x.height+x.height,h=P.width/2-a/2,o=P.height/2-n/2;for(let r=-1;r<t;r++)for(let l=-1;l<e;l++){const c=this.offsetToCube(r,l),g=this.getCubeDistance(i,c);if(g>this.mapRadius+1)continue;const d=r%2!==0,p=r*this.tileWidth+x.width/2+h,u=l*x.height+(d?x.height/2:0)+x.height/2+o,y=g>this.mapRadius?"limit":"hexagon",f=this.scene.add.image(p,u,y).setOrigin(.5);y==="hexagon"&&f.setAlpha(1),f.col=r,f.row=l,this.hexagonList.push(f),this.hexagonMap.set(`${r},${l}`,f)}}createRandomStartTerritory(){const t=this.hexagonList.filter(s=>this.getAroundTiles(s.col).every(i=>{const a=this.hexagonMap.get(`${s.col+i[0]},${s.row+i[1]}`);return a&&a.texture.key!=="limit"})),e=Phaser.Utils.Array.GetRandom(t);return e?([e,...this.getAroundTiles(e.col).map(s=>this.hexagonMap.get(`${e.col+s[0]},${e.row+s[1]}`)).filter(Boolean)].forEach(s=>s.setTexture("my_hexagon")),this.updateQuizMask&&this.updateQuizMask(),e):null}getAroundTiles(t){return t%2!==0?[[0,-1],[0,1],[-1,0],[1,0],[-1,1],[1,1]]:[[0,-1],[0,1],[-1,-1],[1,-1],[-1,0],[1,0]]}offsetToCube(t,e){const s=t,i=e-(t-(t&1))/2,a=-s-i;return{x:s,y:a,z:i}}getCubeDistance(t,e){return(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z))/2}getHexPoints(t,e,s,i){return[t-s/2,e,t-s/4,e-i/2,t+s/4,e-i/2,t+s/2,e,t+s/4,e+i/2,t-s/4,e+i/2]}}class D{static getFittedSize(t,e,s,i){const a=t/e;let n=s,h=n/a;return h>i&&(h=i,n=h*a),{w:n,h}}constructor(t){this.scene=t,this.minimapCam=null,this.quizButton=null,this.medalIcon=null,this.createMinimap()}createMinimap(){const t=this.scene,e=10,s=250,i=250,a=t.world.w,n=t.world.h,{w:h,h:o}=D.getFittedSize(a,n,s,i),r=t.scale.width-h-e,l=e,c=h/a;if(this.minimapCam=t.cameras.add(r,l,h,o).setBounds(0,0,a,n).setZoom(c).setName("minimap"),this.createQuizButtonAndMedal({vx:r,vy:l,miniW:h,miniH:o}),t.hexagonList&&Array.isArray(t.hexagonList)){const g=t.hexagonList.filter(d=>d.texture&&d.texture.key==="hexagon");this.minimapCam.ignore([...g,this.quizButton,this.medalIcon])}t.medalIcon=this.medalIcon}createQuizButtonAndMedal({vx:t,vy:e,miniW:s,miniH:i}){const r=this.scene,l=t+s/2,c=e+i+50;this.quizButton=r.add.image(l,c,"quiz_start").setScale(.6667).setScrollFactor(0).setDepth(9999).setInteractive({useHandCursor:!0}),I(this.quizButton),this.quizButton.on("pointerdown",this.snapshot,this);const d=`medal_${R(this.hexagonPercent())}`,p=l+this.quizButton.displayWidth/2+-220,u=c;this.medalIcon=r.add.image(p,u,d).setScale(.7).setScrollFactor(0).setDepth(9999)}snapshot(){const t=this.scene,e=t.cameras.main;t.scene.pause(),document.querySelector("canvas").style.opacity="0";const s=[t.player,t.enemies,this.minimapCam,this.quizButton,t.items,t.trailGraphics],i=t.stage.hexagonList.filter(g=>g.visible!==!1&&g.texture&&g.texture.key!=="limit"),a=[t.stage.bgDim];[...s,...i,...a].forEach(g=>g&&g.setVisible(!1));let n=t.stage&&t.stage.quizBg,h=null;n&&n.mask&&(h=n.mask,n.setMask(null));const o=e.zoom,r=t.canvasSize.w/t.world.w,l=t.canvasSize.h/t.world.h,c=Math.min(r,l);e.stopFollow().setZoom(c).setScroll(0,0),t.game.renderer.snapshot(g=>{n&&h&&n.setMask(h),t.game.renderer.snapshot(d=>{[...s,...i,...a].forEach(p=>p&&p.setVisible(!0)),e.setZoom(o).startFollow(t.player),t.textures.exists("worldSnapshot")&&t.textures.remove("worldSnapshot"),t.textures.exists("worldSnapshotNoHexagon")&&t.textures.remove("worldSnapshotNoHexagon"),t.textures.addImage("worldSnapshot",d),t.textures.addImage("worldSnapshotNoHexagon",g),t.scene.launch("QuizScene",{quiz:t.quiz,allQuizzes:t.allQuizzes,canvasSize:t.canvasSize,percent:this.hexagonPercent()})})})}hexagonPercent(){const t=this.scene.hexagonList,e=t.filter(i=>i.texture.key!=="limit").length,s=t.filter(i=>i.texture.key==="my_hexagon").length;return e===0?0:Math.floor(s/e*100)}updateMedal(){if(this.medalIcon){const e=`medal_${R(this.hexagonPercent())}`;this.medalIcon.setTexture(e)}}}class it extends Phaser.Scene{constructor(){super("PlayScene"),this.playConfig=A,this.quizData=et}init(t={}){this.allQuizzes=t.allQuizzes||this.quizData,this.quiz=t.quiz||Phaser.Utils.Array.GetRandom(this.allQuizzes),this.showMedalOnStart=t.showMedalOnStart||!1,this.initGameState()}preload(){this.load.image(this.quiz.answer,this.quiz.quizImage)}create(){this.cameras.main.setBackgroundColor("#FBE68D"),this.initStage(),this.trailGraphics=this.add.graphics().setDepth(0),this.trailPath=[],this.player=this.physics.add.sprite(this.playerStartTile.x,this.playerStartTile.y,"player"),this.player.setCollideWorldBounds(!0),this.player.setDepth(1),this.physics.world.setBounds(0,0,this.world.w,this.world.h),this.cameras.main.setBounds(0,0,this.world.w,this.world.h),this.cameras.main.startFollow(this.player),this.dir=new Phaser.Math.Vector2(1,0),this.player.setVelocity(this.dir.x*this.playerSpeed,this.dir.y*this.playerSpeed),this.enemies=this.physics.add.group({collideWorldBounds:!0});for(let t=0;t<this.enemyCount;t++)this.spawnEnemySimple();this.spawnTimer=this.time.addEvent({delay:3e3,callback:this.spawnEnemySimple,callbackScope:this,loop:!0}),this.items=this.physics.add.group(),this.itemTimer=this.time.addEvent({delay:7e3,callback:this.spawnItem,callbackScope:this,loop:!0}),this.miniMap=new D(this),this.physics.add.overlap(this.player,this.enemies,()=>!this.isInvincible&&this.gameOver("hit_enemy")),this.physics.add.overlap(this.player,this.items,this.eatItem,null,this),this.showMedalOnStart&&(this.scene.pause(),this.scene.launch("MedalScene",{remainingQuizzes:this.allQuizzes}))}update(){if(this.playerMoving(),this.updateTrailPath(),this.speedEffect&&this.speedEffect.visible&&(this.speedEffect.x=this.player.x,this.speedEffect.y=this.player.y),this.shieldEffect&&this.shieldEffect.visible&&(this.shieldEffect.x=this.player.x,this.shieldEffect.y=this.player.y),!this.isInvincible&&this.checkSelfTrailCollision(this.player)){this.gameOver("hit_trail");return}!this.isInvincible&&this.checkEnemiesHitTrail()||(this.cullEnemiesOnMyHex(),this.miniMap&&this.miniMap.updateMedal())}initStage(){this.stage=new st({scene:this,properties:{answer:this.quiz.answer}}),this.playerStartTile=this.stage.createRandomStartTerritory(),this.hexagonList=this.stage.hexagonList}drawHexBorder(t,e,s=16724838,i=4){const a=this.hexagonSize.w,n=this.hexagonSize.h,h=a/2,o=n/2,r=[{x:t-h,y:e},{x:t-h/2,y:e-o},{x:t+h/2,y:e-o},{x:t+h,y:e},{x:t+h/2,y:e+o},{x:t-h/2,y:e+o},{x:t-h,y:e}];this.trailGraphics.lineStyle(i,s,1),this.trailGraphics.beginPath(),this.trailGraphics.moveTo(r[0].x,r[0].y);for(let l=1;l<r.length;l++)this.trailGraphics.lineTo(r[l].x,r[l].y);this.trailGraphics.strokePath()}initGameState(){this.isGameOver=!1,this.world={w:this.playConfig.WORLD_W,h:this.playConfig.WORLD_H},this.canvasSize={w:this.playConfig.CANVAS_W,h:this.playConfig.CANVAS_H},this.hexagonSize={w:this.playConfig.HEXAGON_W,h:this.playConfig.HEXAGON_H},this.hexagonList=[],this.playerSpeed=this.playConfig.PLAY_SPEED,this.turnEase=this.playConfig.TURN_EASE,this.isDrawing=!1,this.interval=this.playConfig.LINE_INTERVAL,this.trailWidth=this.playConfig.TRAIL_WIDTH,this.trailColor=this.playConfig.TRAIL_COLOR,this.isInvincible=!1,this.invincibilityTimer=null,this.originalPlayerSpeed=this.playerSpeed,this.speedBoostTimer=null,this.enemies=null,this.enemyCount=this.playConfig.EARLY_ENEMY_COUNT,this.enemySpeed=this.playConfig.EARLY_ENEMY_SPEED,this.enemyRange=this.playConfig.EARLY_ENEMY_RANGE,this.enemyRadius=this.playConfig.EARLY_ENEMY_RADIUS,this.enemyFrozen=!1,this.frozenEnemies=new Set,this.freezeTimer=null,this.items=null,this.speedEffect=null,this.shieldEffect=null}findInnerHoles(t=!0){if(!Array.isArray(this.hexagonList)||!this.hexagonList.length)return[];const e=(r,l)=>`${r},${l}`,s=new Map;for(const r of this.hexagonList)!r||r.col==null||r.row==null||s.set(e(r.col,r.row),r);const i=(r,l,c)=>s.get(e(r.col+l,r.row+c))||null,a=r=>r%2===0?[[0,-1],[0,1],[-1,-1],[1,-1],[-1,0],[1,0]]:[[0,-1],[0,1],[-1,0],[1,0],[-1,1],[1,1]],n=r=>!!r&&r.texture?.key!=="my_hexagon"&&r.texture?.key!=="limit",h=new Set,o=[];for(const r of this.hexagonList){if(!n(r))continue;const l=e(r.col,r.row);if(h.has(l))continue;const c=[],g=[r];h.add(l);let d=!1;for(;g.length;){const p=g.shift();c.push(p);for(const[u,y]of a(p.col)){const f=i(p,u,y);if(!f){d=!0;continue}if(f.texture?.key==="limit"){d=!0;continue}if(n(f)){const B=e(f.col,f.row);h.has(B)||(h.add(B),g.push(f))}}}d||(t&&c.forEach(p=>this.markAsMyHexagon(p)),o.push(c))}return o}playerMoving(){if(!this.player||!this.player.body)return;const t=this.input.activePointer,e=this.cameras.main.getWorldPoint(t.x,t.y),s=e.x-this.player.x,i=e.y-this.player.y;if(this.isLockedOnWall){const p=new Phaser.Math.Vector2(this.player.x-this.lastCollidingHex.x,this.player.y-this.lastCollidingHex.y).normalize();new Phaser.Math.Vector2(s,i).normalize().dot(p)>.5&&(this.isLockedOnWall=!1)}const a=new Phaser.Math.Vector2(s,i);if(a.length()<1){this.player.setVelocity(0,0);return}if(a.normalize(),!this.isLockedOnWall){const p=this.game.loop.delta/1e3,u=1-Math.exp(-this.turnEase*p);this.dir.lerp(a,u)}this.dir.normalize();const n=this.dir,h=this.playerSpeed*(this.game.loop.delta/1e3),o=this.player.x+n.x*h,r=this.player.y+n.y*h;let l=!1,c=null;const g=20,d=[{x:o,y:r},{x:o+n.x*g,y:r+n.y*g},{x:o+n.y*g,y:r-n.x*g},{x:o-n.y*g,y:r+n.x*g}];for(const p of d){const u=this.getNearestHexagon(p.x,p.y);if(u&&u.texture.key==="limit"){l=!0,c=u;break}}if(!l)this.player.setVelocity(n.x*this.playerSpeed,n.y*this.playerSpeed),this.player.setAngle(Phaser.Math.RadToDeg(Math.atan2(n.y,n.x)));else{this.isLockedOnWall=!0,this.lastCollidingHex=c;const p=new Phaser.Math.Vector2(this.player.x-c.x,this.player.y-c.y),u=this.hexagonSize.w/2+g;p.setLength(u),this.player.setPosition(c.x+p.x,c.y+p.y);const y=new Phaser.Math.Vector2(this.player.x-c.x,this.player.y-c.y).normalize(),f=new Phaser.Math.Vector2(y.y,-y.x),B=new Phaser.Math.Vector2(-y.y,y.x),ct=n.dot(f),dt=n.dot(B),v=ct>dt?f:B;this.player.setVelocity(v.x*this.playerSpeed,v.y*this.playerSpeed),this.dir.set(v.x,v.y),this.player.setAngle(Phaser.Math.RadToDeg(Math.atan2(v.y,v.x)))}}updateTrailPath(){const t=this.player.x,e=this.player.y,s=this.isOnMyHexagon(t,e);if(!s&&!this.isDrawing?this.startTrail(t,e):!s&&this.isDrawing?this.updateTrail(t,e):s&&this.isDrawing&&this.finishTrail(),this.checkSelfTrailCollision(this.player)){this.gameOver("hit_trail");return}}checkSelfTrailCollision(t,e=6,s=this.trailWidth){const i=this.trailPath.length;if(i<3)return!1;const a=i-1-e;if(a<=0)return!1;const n=s,h=n*n;for(let o=0;o<a;o++){const r=this.trailPath[o],l=this.trailPath[o+1],c=this.pointToSegmentDistance(t.x,t.y,r.x,r.y,l.x,l.y);if(c*c<=h)return!0}return!1}pointToSegmentDistance(t,e,s,i,a,n){const h=this.squaredDistance(s,i,a,n);if(h===0)return Math.sqrt(this.squaredDistance(t,e,s,i));const o=this.clampToUnit(((t-s)*(a-s)+(e-i)*(n-i))/h),r=s+o*(a-s),l=i+o*(n-i);return Math.sqrt(this.squaredDistance(t,e,r,l))}squaredDistance(t,e,s,i){const a=t-s,n=e-i;return a*a+n*n}clampToUnit(t){return t<0?0:t>1?1:t}isOnMyHexagon(t,e){const s=this.getNearestHexagon(t,e);if(!s||s.texture?.key!=="my_hexagon")return!1;const i=s.displayWidth||this.hexagonSize.w,a=s.displayHeight||this.hexagonSize.h;return this.pointInFlatTopHex(t,e,s.x,s.y,i,a,1)}pointInFlatTopHex(t,e,s,i,a,n,h=1){const o=a*h/2,r=n*h/2,l=[s-o,i,s-o/2,i-r,s+o/2,i-r,s+o,i,s+o/2,i+r,s-o/2,i+r],c=new Phaser.Geom.Polygon(l);return Phaser.Geom.Polygon.Contains(c,t,e)}startTrail(t,e){this.isDrawing=!0,this.trailPath.length=0,this.trailPath.push({x:t,y:e}),this.trailGraphics.clear(),this.trailGraphics.fillStyle(this.trailColor,1),this.trailGraphics.fillCircle(t,e,this.trailWidth/2)}updateTrail(t,e){const s=this.trailPath[this.trailPath.length-1],i=Phaser.Math.Distance.Between(s.x,s.y,t,e);if(i<this.interval)return;this.trailPath.push({x:t,y:e});const a=Math.ceil(i/(this.trailWidth*.6));for(let n=1;n<=a;n++){const h=n/a,o=Phaser.Math.Interpolation.Linear([s.x,t],h),r=Phaser.Math.Interpolation.Linear([s.y,e],h);this.trailGraphics.fillCircle(o,r,this.trailWidth/2);const l=this.getNearestHexagon(o,r);l&&l.texture?.key!=="my_hexagon"&&l.texture?.key!=="limit"&&this.drawHexBorder(l.x,l.y)}}finishTrail(){if(this.isDrawing=!1,this.trailPath.length<5){this.trailGraphics.clear(),this.trailPath.length=0;return}this.trailGraphics.clear();const t=this.trailPath.slice(),e=this.activeHexagon(t,!1);this.paintInsideAndBorder(t,e),this.trailPath.length=0,this.findInnerHoles(!0)}paintInsideAndBorder(t,e){const s=new Set,i=a=>{if(!a||a.texture?.key==="my_hexagon")return;const n=a.col!==void 0&&a.row!==void 0?`${a.col},${a.row}`:`${a.x},${a.y}`;s.has(n)||(s.add(n),this.markAsMyHexagon(a))};for(const a of e)i(a);for(const a of t){const n=this.getNearestHexagon(a.x,a.y);i(n)}}activeHexagon(t=this.trailPath,e=!0){if(!t||t.length<3||!Array.isArray(this.hexagonList))return[];const s=t.slice(),i=s[0],a=s[s.length-1];Phaser.Math.Distance.Between(i.x,i.y,a.x,a.y)>1&&s.push({x:i.x,y:i.y});const n=[];for(const d of s)n.push(d.x,d.y);const h=new Phaser.Geom.Polygon(n),o=Phaser.Geom.Rectangle.FromPoints(s.map(d=>new Phaser.Geom.Point(d.x,d.y))),r=[],l=Math.max(1,Math.min(this.hexagonSize.w,this.hexagonSize.h)*.35),c=8,g=(d,p)=>{if(Phaser.Geom.Polygon.Contains(h,d,p))return!0;for(let u=0;u<c;u++){const y=Math.PI*2*u/c,f=d+l*Math.cos(y),B=p+l*Math.sin(y);if(Phaser.Geom.Polygon.Contains(h,f,B))return!0}return!1};for(const d of this.hexagonList){const{x:p,y:u}=d;Phaser.Geom.Rectangle.Contains(o,p,u)&&g(p,u)&&r.push(d)}return e&&r.forEach(d=>this.markAsMyHexagon(d)),r}getNearestHexagon(t,e){let s=null,i=1/0;for(const a of this.hexagonList){const n=Phaser.Math.Distance.Between(t,e,a.x,a.y);n<i&&(i=n,s=a)}return s}getClosestWallToPoint(t){let e=null,s=1/0;const i=this.playerBoundsHexagon.points;for(let a=0;a<i.length;a++){const n=i[a],h=i[(a+1)%i.length],o=new Phaser.Geom.Line(n.x,n.y,h.x,h.y),r=new Phaser.Geom.Point;Phaser.Geom.Line.GetNearestPoint(o,t,r);const l=Phaser.Math.Distance.Between(t.x,t.y,r.x,r.y);l<s&&(s=l,e=o)}return e}gameOver(t="hit_trail"){this.isGameOver||(this.isGameOver=!0,this.physics.world.pause(),this.player.setVelocity(0,0),this.isDrawing=!1,this.spawnTimer?.remove(),this.tweens.add({targets:this.player,alpha:{from:1,to:.2},yoyo:!0,duration:100,repeat:4}),this.time.delayedCall(350,()=>{this.scene.pause(),this.scene.launch("GameOverScene",{reason:t})}))}pickPattern(){return Phaser.Math.RND.pick(["LR","APPROACH","UD","APPROACH","CIRCLE","RECT","APPROACH"])}spawnEnemySimple(t=this.pickPattern()){if(!this.enemies)return;const e=this.canvasSize.w/2,s=this.canvasSize.h/2,i=this.world.w,a=this.world.h,n=50,h=200;let o,r,l=0,c=!1;const g=(d,p)=>{const u=this.getNearestHexagon(d,p);return!u||u.texture.key==="limit"||this.isOnMyHexagon(d,p)?!1:!this.hexagonList.filter(f=>Phaser.Math.Distance.Between(f.x,f.y,u.x,u.y)<60&&f!==u).some(f=>f.texture?.key==="limit")};for(;!c&&l<n;){o=Phaser.Math.Between(e,i),r=Phaser.Math.Between(s,a);const d=Phaser.Math.Distance.Between(o,r,this.player.x,this.player.y);g(o,r)&&d>h&&(c=!0),l++}if(c){const d=this.enemies.create(o,r,"enemy");return d.setSize(this.enemyRadius*2,this.enemyRadius*2),d.setScale(.7),d.setDepth(1),this.startPattern(d,t),d}return null}startPattern(t,e){if(!t||!t.active||t.pendingRemoval)return;const s=this.canvasSize.w/2,i=this.canvasSize.h/2,a=this.world.w,n=this.world.h;switch(e){case"LR":return this.startLR(t,s,a);case"UD":return this.startUD(t,i,n);case"CIRCLE":return this.startCircle(t,s,a,i,n);case"APPROACH":return this.startApproach(t,s,a,i,n);default:return this.startRect(t,s,a,i,n)}}nextPattern(t){!t||!t.active||t.pendingRemoval||this.startPattern(t,this.pickPattern())}go(t,e,s){if(!t||!t.active||t.pendingRemoval)return;const i=Phaser.Math.Distance.Between(t.x,t.y,e.x,e.y),a=Math.max(50,i/(this.enemySpeed||90)*1e3);this.tweens.killTweensOf(t),this.tweens.add({targets:t,x:e.x,y:e.y,duration:a,ease:"Linear",onComplete:s})}chain(t,e,s){let i=0;const a=()=>{if(!t||!t.active||t.pendingRemoval)return;if(i>=e.length){s&&s();return}const n=e[i++];this.go(t,n,a)};a()}startLR(t,e,s){const i=Math.floor((this.enemyRange||200)/2),a=Phaser.Math.Clamp(t.x-i,e,s),n=Phaser.Math.Clamp(t.x+i,e,s),h=(c,g)=>{const d=this.getNearestHexagon(c,g);return d&&d.texture.key!=="limit"},o=[];if(h(a,t.y)&&o.push({x:a,y:t.y}),h(n,t.y)&&o.push({x:n,y:t.y}),o.length<2)return this.nextPattern(t);const l=Math.abs(t.x-a)<=Math.abs(t.x-n)?o:o.slice().reverse();this.chain(t,l,()=>this.nextPattern(t))}startUD(t,e,s){const i=Math.floor((this.enemyRange||200)/2),a=Phaser.Math.Clamp(t.y-i,e,s),n=Phaser.Math.Clamp(t.y+i,e,s),h=(c,g)=>{const d=this.getNearestHexagon(c,g);return d&&d.texture.key!=="limit"},o=[];if(h(t.x,a)&&o.push({x:t.x,y:a}),h(t.x,n)&&o.push({x:t.x,y:n}),o.length<2)return this.nextPattern(t);const l=Math.abs(t.y-a)<=Math.abs(t.y-n)?o:o.slice().reverse();this.chain(t,l,()=>this.nextPattern(t))}startCircle(t,e,s,i,a){const n=Phaser.Math.Between(80,140),h=Math.min(t.x-e,s-t.x,t.y-i,a-t.y),o=Math.max(20,Math.min(n,h)),r=t.x,l=t.y,c=12,g=[],d=(p,u)=>{const y=this.getNearestHexagon(p,u);return y&&y.texture.key!=="limit"};for(let p=1;p<=c;p++){const u=2*Math.PI*p/c,y=r+o*Math.cos(u),f=l+o*Math.sin(u);d(y,f)&&g.push({x:y,y:f})}if(g.length<3)return this.nextPattern(t);this.chain(t,g,()=>this.nextPattern(t))}startRect(t,e,s,i,a){const n=Math.floor(Phaser.Math.Between(160,260)/2),h=Math.floor(Phaser.Math.Between(120,220)/2),o=Phaser.Math.Clamp(t.x-n,e,s),r=Phaser.Math.Clamp(t.x+n,e,s),l=Phaser.Math.Clamp(t.y-h,i,a),c=Phaser.Math.Clamp(t.y+h,i,a),g=(p,u)=>{const y=this.getNearestHexagon(p,u);return y&&y.texture.key!=="limit"},d=[];if(g(o,l)&&d.push({x:o,y:l}),g(r,l)&&d.push({x:r,y:l}),g(r,c)&&d.push({x:r,y:c}),g(o,c)&&d.push({x:o,y:c}),d.length<3)return this.nextPattern(t);this.chain(t,d,()=>this.nextPattern(t))}startApproach(t,e,s,i,a){if(!t||!t.active||t.pendingRemoval)return;if(!this.player)return this.nextPattern(t);const n=this.player.x-t.x,h=this.player.y-t.y,o=Math.hypot(n,h);if(o<1)return this.nextPattern(t);const r=Math.min(this.enemyRange||100,o),l=n/o,c=h/o;let g=t.x+l*r,d=t.y+c*r;g=Phaser.Math.Clamp(g,e,s),d=Phaser.Math.Clamp(d,i,a),this.go(t,{x:g,y:d},()=>this.nextPattern(t))}cullEnemiesOnMyHex(){if(!this.enemies)return;const t=this.enemies.getChildren();for(let e=t.length-1;e>=0;e--){const s=t[e];!s||!s.active||this.isOnMyHexagon(s.x,s.y)&&this.fadeOutAndRemoveEnemy(s)}}fadeOutAndRemoveEnemy(t){t.pendingRemoval||(t.pendingRemoval=!0,this.tweens.killTweensOf(t),t.setVelocity?.(0,0),t.body&&(t.body.enable=!1),this.tweens.add({targets:t,alpha:{from:1,to:.2},yoyo:!0,duration:120,repeat:4,onComplete:()=>{this.tweens.killTweensOf(t),t.destroy()}}))}checkEnemiesHitTrail(){if(!this.enemies||!this.isDrawing)return;const t=this.trailPath.length;if(t<2)return!1;const e=this.enemies.getChildren();if(!e||e.length===0)return!1;for(let s=0;s<e.length;s++){const i=e[s];if(!i||!i.active||i.pendingRemoval)continue;const a=this.trailWidth*.5+this.enemyRadius;for(let n=0;n<t;n+=1){const h=this.trailPath[n],o=i.x-h.x,r=i.y-h.y;if(o*o+r*r<=a*a)return this.gameOver("enemy_hit_trail"),!0}}return!1}markAsMyHexagon(t){t&&(t.texture?.key==="my_hexagon"||t.texture?.key==="limit"||(t.setTexture("my_hexagon"),t.setDepth&&t.setDepth(1),this.stage&&typeof this.stage.updateQuizMask=="function"&&this.stage.updateQuizMask()))}spawnItem(){if(!this.items)return;const t=["freeze","speed","invincible"],e=Phaser.Math.RND.pick(t),s=this.items.getChildren?this.items.getChildren():[],i=this.hexagonList.filter(h=>h.texture?.key==="limit"||this.isOnMyHexagon(h.x,h.y)?!1:!s.some(o=>{const r=(o.x??0)-h.x,l=(o.y??0)-(h.y-10);return Math.sqrt(r*r+l*l)<30}));if(i.length===0)return;const a=Phaser.Math.RND.pick(i),n=this.items.create(a.x,a.y-10,`item_${e}`);n.setScale(.53),n.itemType=e,this.time.delayedCall(3e4,()=>{n.active&&n.destroy()},[],this)}eatItem(t,e){this.applyItemEffect(e),e.destroy()}applyItemEffect(t){switch(t.itemType){case"freeze":this.freezeEnemies(1e4);break;case"speed":this.boostPlayerSpeed(1e4,100);break;case"invincible":this.makePlayerInvincible(1e4);break}}freezeEnemies(t){if(this.enemyFrozen){this.time.delayedCall(t,this.unfreezeEnemies,[],this);return}this.enemyFrozen=!0,this.spawnTimer&&(this.spawnTimer.paused=!0);const e=this.enemies.getChildren();for(const s of e)this.tweens.killTweensOf(s),s.setVelocity(0),s.setTexture("enemy_freeze"),this.frozenEnemies.add(s);this.time.delayedCall(t,this.unfreezeEnemies,[],this)}unfreezeEnemies(){this.enemyFrozen=!1;for(const t of this.frozenEnemies)t&&t.active&&(t.setTexture("enemy"),this.startPattern(t,this.pickPattern()));this.frozenEnemies.clear(),this.time.delayedCall(0,()=>this.cullEnemiesOnMyHex()),this.spawnTimer&&(this.spawnTimer.paused=!1)}boostPlayerSpeed(t,e){if(this.speedBoostTimer){const s=this.speedBoostTimer.getRemaining();this.speedBoostTimer.remove(),t+=s}this.speedBoostTimer&&this.speedBoostTimer.remove(),this.playerSpeed=this.originalPlayerSpeed+e,this.anims.exists("speed_effect")||this.anims.create({key:"speed_effect",frames:this.anims.generateFrameNumbers("buster_effect",{start:0,end:41}),frameRate:15,repeat:-1}),this.speedEffect||(this.speedEffect=this.add.sprite(this.player.x,this.player.y,"buster_effect"),this.speedEffect.setDepth(this.player.depth-1)),this.speedEffect.setVisible(!0),this.speedEffect.play("speed_effect",!0),this.speedBoostTimer=this.time.delayedCall(t,()=>{this.playerSpeed=this.originalPlayerSpeed,this.player.setTexture("player"),this.speedEffect&&this.speedEffect.setVisible(!1)},[],this)}makePlayerInvincible(t){this.shieldEffectTimer&&this.shieldEffectTimer.remove(),this.isInvincible=!0,this.anims.exists("shield_effect")||this.anims.create({key:"shield_effect",frames:this.anims.generateFrameNumbers("shield_effect",{start:0,end:33}),frameRate:20,repeat:-1}),this.shieldEffect||(this.shieldEffect=this.add.sprite(this.player.x,this.player.y,"shield_effect"),this.shieldEffect.setDepth(2)),this.shieldEffect.setVisible(!0),this.shieldEffect.play("shield_effect",!0),this.shieldEffectTimer=this.time.delayedCall(t,()=>{this.isInvincible=!1,this.player.setTexture("player"),this.shieldEffect&&this.shieldEffect.setVisible(!1)},[],this)}}const N={fontSize:"60px",fontFamily:M},G={...N,color:"#fddc3e"},z={...N,color:"#ffffff"},q={...N,color:"#c4a5fd"},F={hit_enemy:[{text:"꿀벌",style:G},{text:"이 ",style:z},{text:"적",style:q},{text:"과 부딪혔어요!",style:z}],hit_trail:[{text:"꿀벌",style:G},{text:"이 ",style:z},{text:"선",style:q},{text:"에 닿았어요!",style:z}],enemy_hit_trail:[{text:"적",style:G},{text:"이 ",style:z},{text:"선",style:q},{text:"에 닿았어요!",style:z}],default:[{text:"게임 오버!",style:z}]},Y=[`아쉬워!
할 수 있었는데!`,`아까워!
실수한 거야!`,`아,
잘하고 있었는데!`,`다시 해보자!
할 수 있어!`,`괜찮아,
다시 하면 돼!`,`다음엔
꼭 성공한다!`,`조금 어렵지만
할 수 있어!`,`침착하게
다시 해보자!`,`포기 안 해!
다시 할거야!`,`이제 알겠어!
다시 도전!`,`감 잡았어!
이번엔 성공할거야!`,`앗! 아깝다~!
다시 도전!`,`실수할 수도 있지!
다시 하자!`];class at extends Phaser.Scene{constructor(){super("GameOverScene")}init(t){this.reason=t.reason}create(){this.centerX=this.cameras.main.width/2,this.centerY=this.cameras.main.height/2,C(this,0,.7),this.createUI(),this.createText(),this.createButton()}initBackground(){const t=this.add.graphics();t.fillStyle(0,.7),t.fillRect(0,0,this.sys.game.config.width,this.sys.game.config.height)}createUI(){this.add.image(this.centerX-100,this.centerY-130,"bee_gameOver").setScale(.6667),this.add.image(this.centerX+150,this.centerY-150,"balloon_gameOver").setScale(.6667),this.add.image(this.centerX,this.centerY+90,"text_box").setScale(.6667)}createText(){this.createResonText(),this.createBalloonText()}createButton(){const t=this.add.image(this.centerX,this.centerY+245,"return_btn").setScale(.6667).setInteractive({useHandCursor:!0});t.on("pointerover",()=>t.setFrame(1)),t.on("pointerout",()=>t.setFrame(0)),t.on("pointerdown",()=>this.chageScene())}chageScene(){this.scene.stop("GameOverScene"),this.scene.start("StartScene")}createResonText(){const t=F[this.reason]||F.default,e=this.add.container(0,0);let s=0;for(const a of t){const n=this.add.text(0,0,a.text,a.style);n.setX(s),s+=n.width,e.add(n)}const i=e.getBounds();e.setPosition(this.centerX-i.width/2,this.centerY+50)}createBalloonText(){const t=Math.floor(Math.random()*Y.length),e=Y[t],s=this.add.container(0,0),i=this.add.text(0,0,e,{fontSize:"48px",fontFamily:M,color:"#000000",align:"center"}),a=i.getBounds();i.setPosition(-a.width/2,-a.height/2),s.add(i),s.setPosition(this.centerX+170,this.centerY-150)}}const _={WIDTH:300,HEIGHT:80,PADDING_Y:20,COLOR_PURPLE:9194654,COLOR_YELLOW:16636990},O=(m,t="48px")=>({fontFamily:M,fontStyle:"bold",padding:{top:5},color:m,fontSize:typeof t=="number"?`${t}px`:t}),S={PINK:O("#f471aa"),BLUE:O("#346f9e"),DIAMOND:O("#10c4c4"),GOLD:O("#ffd15b"),SILVER:O("#cbe5e8"),BRONZE:O("#ca6e59"),BROWN:O("#6d4a43","40px")},nt={1:"다이아몬드",2:"금",3:"은",4:"동"},rt={1:S.DIAMOND,2:S.GOLD,3:S.SILVER,4:S.BRONZE};class ot extends Phaser.Scene{constructor(){super("QuizScene")}init(t){this.quiz=t.quiz,this.allQuizzes=t.allQuizzes,this.canvasSize=t.canvasSize,this.percent=t.percent}preload(){this.load.image(this.quiz.answer+"_full",this.quiz.fullImage)}create(){const t=document.querySelector("canvas");t.style.transition="opacity 0.5s",setTimeout(()=>{t.style.opacity="1",t.style.transition=""},100),this.cameras.main.setBackgroundColor("#4a2e1d"),this.anims.exists("bee_incorrect_ani")||this.anims.create({key:"bee_incorrect_ani",frames:this.anims.generateFrameNumbers("bee_fail",{start:0,end:89}),frameRate:10,repeat:-1}),this.anims.exists("bee_correct_ani")||this.anims.create({key:"bee_correct_ani",frames:this.anims.generateFrameNumbers("bee_win",{start:0,end:22}),frameRate:10,repeat:-1}),this.add.text(this.scale.width/2,80,"그림이 나타내는 영어 단어는 무엇일까요?",{fontSize:"50px",color:"#ffffff",fontFamily:M}).setOrigin(.45),this.medalNumber=R(this.percent),this.add.image(100,80,`medal_${this.medalNumber}`).setScale(1),this.textures.exists("worldSnapshot")&&(this.snapshotImage=this.renderMaskedImage("worldSnapshot")),this.renderAnswerButtons(),this.exitButton=this.renderFeedbackButton("exit_btn",()=>this.returnToPlayScene())}createHexMaskGraphics(t,e,s){const i=this.make.graphics({x:0,y:0,add:!1}),a=t+s/2-2,n=e+s/2-2,h=s/2-2;i.beginPath();for(let o=0;o<6;o++){const r=Phaser.Math.DegToRad(60*o-30),l=a+h*Math.cos(r),c=n+h*Math.sin(r);o===0?i.moveTo(l,c):i.lineTo(l,c)}return i.closePath(),i.fillPath(),i}renderMaskedImage(t,e=1,s=300,i=300){const{w:a}=this.canvasSize,n=a/2-s-100,h=i-s/4-2,o=this.add.image(a/4,i,t).setOrigin(0,0).setAlpha(e),{width:r,height:l}=o,c=s/(r>l?l:r);o.setScale(c).setPosition(n,h);const d=this.createHexMaskGraphics(n,h,s).createGeometryMask();return o.setMask(d),o}renderAnswerButtons(){const t=this.quiz.answer,e=Phaser.Utils.Array.Shuffle([...this.quiz.options]),s=this.canvasSize.w/2+150,i=220;this.itemButtonGroup=this.add.group(),e.forEach((a,n)=>{const h=s,o=i+n*(_.HEIGHT+_.PADDING_Y),r=this.createAnswerButton(h,o,a,()=>{this.itemButtonGroup.children.iterate(l=>l.disableInteractive&&l.disableInteractive()),this.exitButton&&this.exitButton.active&&this.exitButton.destroy(),a===t?this.correct():this.incorrect()});this.itemButtonGroup.add(r)})}getWideHexagonPoints(t,e){return[0,e/2,t*.1,0,t*.9,0,t,e/2,t*.9,e,t*.1,e]}createAnswerButton(t,e,s,i){const a=this.getWideHexagonPoints(_.WIDTH,_.HEIGHT),n=new Phaser.Geom.Polygon(a),h=this.add.graphics();h.fillStyle(_.COLOR_YELLOW),h.fillPoints(n.points,!0);const o=this.add.text(_.WIDTH/2,_.HEIGHT/2,s,{fontSize:"36px",fontFamily:M,color:`#${_.COLOR_PURPLE.toString(16)}`,fontStyle:"bold"}).setOrigin(.5),r=this.add.container(t,e,[h,o]);return r.setInteractive(n,Phaser.Geom.Polygon.Contains),r.on("pointerdown",i),r.on("pointerover",()=>{h.clear(),h.fillStyle(_.COLOR_PURPLE),h.lineStyle(4,_.COLOR_YELLOW),h.fillPoints(n.points,!0),h.strokePoints(n.points,!0),o.setColor(`#${_.COLOR_YELLOW.toString(16)}`),this.setCursor("pointer")}),r.on("pointerout",()=>{h.clear(),h.fillStyle(_.COLOR_YELLOW),h.fillPoints(n.points,!0),o.setColor(`#${_.COLOR_PURPLE.toString(16)}`),this.setCursor("default")}),r}renderFeedbackContent(t){let e=0,s=0;const i=10,a=30,n=t.map(l=>{if(l.type==="image"&&l.key==="bee_fail"){const c=128*l.scale+a,g=128*l.scale;return e+=c,{width:c,height:g}}else{const c=this.make.text({text:l.text,style:l.style},!1);return e+=c.width,c.height>s&&(s=c.height),{width:c.width,height:c.height}}});e+=i*(t.length-1);let h=(this.canvasSize.w-e)/2;const o=80,r=o+s/2;t.forEach((l,c)=>{l.type==="image"&&l.key==="bee_fail"?(this.add.sprite(h+64*l.scale,o+20,"bee_fail").setScale(l.scale).setOrigin(.5,.5).play("bee_incorrect_ani"),h+=a):this.add.text(h,r,l.text,l.style).setOrigin(0,1),h+=n[c].width+i})}setCursor(t="default"){this.input&&this.input.setDefaultCursor&&this.input.setDefaultCursor(t)}correct(){this.setCursor("default"),this.sound.play("correct"),this.increaseMedalCount(this.medalNumber),this.showFullAnswerImage(this.snapshotImage),this.renderFeedbackBox(),this.renderFeedbackButton("next_btn",()=>this.goToNextQuiz())}incorrect(){this.setCursor("default"),this.sound.play("incorrect"),this.renderFeedbackBox(!1),this.renderFeedbackButton("main_btn",()=>this.goToNextQuiz())}showFullAnswerImage(t){const{x:e,y:s,displayWidth:i,displayHeight:a,mask:n}=t;t.destroy();const o=this.add.image(e,s,"worldSnapshotNoHexagon").setAlpha(0).setOrigin(0,0),r=i/o.width,l=a/o.height,c=Math.min(r,l);o.setScale(c),o.setPosition(e,s),n&&o.setMask(n),this.tweens.add({targets:o,alpha:1,duration:1e3,ease:"Linear"})}goToNextQuiz(){this.sound.play("click"),this.scene.stop("PlayScene"),this.scene.stop("QuizScene");const t=this.allQuizzes.filter(e=>e.answer!==this.quiz.answer);t.length===0?this.scene.start("PlayScene",{quiz:this.quiz,allQuizzes:t,showMedalOnStart:!0,percent:this.percent}):this.scene.start("PlayScene",{allQuizzes:t,showMedalOnStart:!0,percent:this.percent})}returnToPlayScene(){this.scene.stop("QuizScene"),this.scene.resume("PlayScene")}renderFeedbackButton(t,e){const s=this.canvasSize.w-50,i=this.canvasSize.h-50,a=this.add.image(s,i,t).setOrigin(1,1).setInteractive({useHandCursor:!0});return a.on("pointerdown",()=>e()),a.on("pointerover",()=>a.setTexture(`${t}_h`)),a.on("pointerout",()=>a.setTexture(`${t}`)),a}buildFeedbackContent(t){return t?[{type:"text",text:"정답",style:S.PINK},{type:"text",text:"입니다! ",style:S.BROWN},{type:"text",text:`${nt[this.medalNumber]}메달`,style:rt[this.medalNumber]},{type:"text",text:"획득!",style:S.BROWN}]:[{type:"image",key:"bee_fail",scale:.6},{type:"text",text:"오답",style:S.BLUE},{type:"text",text:"입니다!",style:S.BROWN}]}renderFeedbackBox(t=!0){const e=this.buildFeedbackContent(t),s=100,i=80-s/2;this.add.graphics().fillStyle(16117466,1).fillRect(0,i,this.canvasSize.w,s),t&&(console.log(this.canvasSize),this.add.sprite(this.canvasSize.w/2,this.canvasSize.h/2,"bee_win").setOrigin(.5,.5).play("bee_correct_ani")),this.renderFeedbackContent(e)}increaseMedalCount(t){let e=this.registry.get("myMedals")||{1:0,2:0,3:0,4:0};e[t]++,this.registry.set("myMedals",e)}}const V={fontSize:"40px",color:"#ffffff",fontStyle:"bold",fontFamily:M};class ht extends Phaser.Scene{constructor(){super("MedalScene")}init(t){this.remainingQuizzes=t.remainingQuizzes}create(){this.centerX=this.cameras.main.width/2,this.centerY=this.cameras.main.height/2,C(this,0,.7),this.createButton(),this.createUI(),this.initBgm()}initBgm(){E.isOn?E.play():E.stop()}createButton(){const t=this.remainingQuizzes?.length>0?"start_btn":"reset_btn";this.actionButton=this.add.image(this.centerX,660,t).setScale(.6667).setInteractive({useHandCursor:!0}),this.homeButton=this.add.image(50,50,"home_btn").setOrigin(0,0).setInteractive({useHandCursor:!0}),this.homeButton.on("pointerdown",()=>{this.sound.play("click"),this.scene.start("StartScene")}),this.actionButton.on("pointerdown",()=>{this.sound.play("click"),this.changeScene()}),k(this.actionButton,`${t}`),this.createBgmButton()}changeScene(){this.remainingQuizzes?.length>0?(this.scene.stop("MedalScene"),this.scene.resume("PlayScene")):(this.scene.stop("PlayScene"),this.scene.stop("MedalScene"),this.scene.start("StartScene"))}createUI(){this.add.image(250,this.centerY+15,"bee_medal"),this.medalUI=this.createMedalBox().setPosition(this.centerX-150,this.centerY-40)}createMedalBox(){const t=this.remainingQuizzes?.length>0?"숨겨진 그림의 정체를 밝혀내라!":"숨겨진 그림의 정체를 모두 밝혔다!",e=this.registry.get("myMedals")||{1:0,2:0,3:0,4:0},s=this.add.container(0,0),i=700,a=180,n=this.add.text(i/2,-60,t,V).setOrigin(.5),h=this.add.graphics();h.lineStyle(4,16636990,1),h.fillStyle(0,.5),h.strokeRoundedRect(0,0,i,a,15),h.fillRoundedRect(0,0,i,a,15);const o=[h,n],r=["medal_1","medal_2","medal_3","medal_4"],l=i/r.length;return r.forEach((c,g)=>{const d=l*(g+.5),p=70,u=this.add.image(d,p,c).setScale(1.2),y=this.add.text(d,p+70,`${e[g+1]}`,V).setOrigin(.5);o.push(u,y)}),s.add(o),s}createBgmButton(){this.bgmBtn=this.add.image(1140,610,"bgm_O").setInteractive({useHandCursor:!0}).setScrollFactor(0),this.updateBgmButtonTexture(!E.isOn),this.bgmBtn.on("pointerdown",()=>{E.toggle(),this.updateBgmButtonTexture(!E.isOn),this.sound.play("click")})}updateBgmButtonTexture(t){this.bgmBtn.setTexture(t?"bgm_X":"bgm_O")}}A.TRAIL_COLOR=parseInt(A.TRAIL_COLOR,16);const lt={type:Phaser.WEBGL,width:1280,height:720,parent:"gameContainer",backgroundColor:"0xc9effa",scene:[X,U,$,Z,it,at,ot,ht],physics:{default:"arcade",arcade:{debug:!1}},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH}};new Phaser.Game(lt)})();
